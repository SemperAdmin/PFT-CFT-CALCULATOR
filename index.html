<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#8B0000">
    <meta name="description" content="Official USMC PFT and CFT Score Calculator based on MCO 6100.13A">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="USMC PFT/CFT">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <title>USMC PFT Calculator - Semper Admin</title>
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-gradient-start: #8B0000;
            --bg-gradient-end: #FFD700;
            --text-primary: #333333;
            --text-secondary: #666666;
            --border-color: #dee2e6;
            --card-shadow: rgba(0,0,0,0.1);
            --marine-red: #8B0000;
            --marine-gold: #FFD700;
        }

        [data-theme="dark"] {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-gradient-start: #0f0f1a;
            --bg-gradient-end: #1a1a2e;
            --text-primary: #e4e4e4;
            --text-secondary: #a0a0a0;
            --border-color: #333355;
            --card-shadow: rgba(0,0,0,0.3);
            --marine-red: #aa2222;
            --marine-gold: #FFD700;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .disclaimer {
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            font-size: 0.9em;
            color: var(--text-secondary);
            text-align: center;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-primary);
            transition: background 0.3s ease;
        }

        [data-theme="dark"] body {
            background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 100%);
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: var(--bg-primary);
            border-radius: 10px;
            box-shadow: 0 10px 30px var(--card-shadow);
            overflow: hidden;
        }

        .header {
            background: var(--marine-red);
            color: var(--marine-gold);
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .header .brand {
            font-size: 0.9em;
            opacity: 0.8;
            font-style: italic;
        }

        /* Header Utility Buttons */
        .header-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        .utility-btn {
            background: rgba(255,215,0,0.2);
            border: 2px solid var(--marine-gold);
            color: var(--marine-gold);
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .utility-btn:hover {
            background: var(--marine-gold);
            color: var(--marine-red);
        }

        .main-content {
            display: flex;
            flex-wrap: wrap;
            min-height: 600px;
        }

        .form-section {
            flex: 1;
            min-width: 400px;
            padding: 30px;
            background: var(--bg-secondary);
        }

        .results-section {
            flex: 1;
            min-width: 400px;
            padding: 30px;
            background: var(--bg-primary);
            border-left: 3px solid var(--marine-red);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--text-primary);
        }

        .form-group select,
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: var(--marine-red);
        }

        .event-section {
            background: var(--bg-primary);
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--marine-gold);
            box-shadow: 0 2px 10px var(--card-shadow);
        }

        .event-section h3 {
            color: var(--marine-red);
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        [data-theme="dark"] .event-section h3 {
            color: var(--marine-gold);
        }

        /* Additional Dark Mode Overrides */
        [data-theme="dark"] .total-score {
            background: linear-gradient(135deg, #2a1a1a 0%, #3a2020 100%);
            border: 2px solid var(--marine-gold);
        }

        [data-theme="dark"] .standards-table {
            background: var(--bg-secondary);
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        [data-theme="dark"] .standards-table td {
            border-bottom-color: var(--border-color);
            color: var(--text-primary);
        }

        [data-theme="dark"] .standards-table tr:hover {
            background: var(--bg-primary);
        }

        [data-theme="dark"] .test-tab {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        [data-theme="dark"] .test-tab.active {
            background: var(--marine-red);
            color: var(--marine-gold);
        }

        [data-theme="dark"] .altitude-option {
            background: #1a2a3a;
            border-left-color: #4dabf7;
        }

        [data-theme="dark"] .altitude-option label {
            color: #74c0fc;
        }

        [data-theme="dark"] .no-history {
            color: var(--text-secondary);
        }

        /* Dark Mode for Validation */
        [data-theme="dark"] .form-group input.invalid {
            background-color: #2a1a1a;
            border-color: #dc3545;
        }

        [data-theme="dark"] .error {
            background: #2a1a1a;
            color: #ff8a8a;
            border-left-color: #dc3545;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .radio-option input[type="radio"] {
            width: auto;
        }

        .time-input {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .time-input input {
            width: 80px;
        }

        .calculate-btn {
            width: 100%;
            padding: 15px;
            background: #8B0000;
            color: #FFD700;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .calculate-btn:hover {
            background: #a00000;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .results-card {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid var(--marine-red);
        }

        [data-theme="dark"] .results-card {
            border-left-color: var(--marine-gold);
        }

        .results-card h3 {
            color: var(--marine-red);
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        [data-theme="dark"] .results-card h3 {
            color: var(--marine-gold);
        }

        .score-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-primary);
        }

        .score-item:last-child {
            border-bottom: none;
        }

        .score-value {
            font-weight: bold;
            color: var(--marine-red);
        }

        [data-theme="dark"] .score-value {
            color: var(--marine-gold);
        }

        .total-score {
            background: #8B0000;
            color: #FFD700;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
        }

        .total-score h2 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .classification {
            font-size: 1.5em;
            font-weight: bold;
        }

        .classification.body-comp-incentive {
            color: #17a2b8;
        }

        .classification.first-class {
            color: #28a745;
        }

        .classification.second-class {
            color: #ffc107;
        }

        .classification.third-class {
            color: #fd7e14;
        }

        .classification.fail {
            color: #dc3545;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #dc3545;
            margin-bottom: 20px;
        }

        .standards-table {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 20px;
        }

        .standards-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .standards-table th {
            background: #8B0000;
            color: #FFD700;
            padding: 12px;
            text-align: left;
        }

        .standards-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #dee2e6;
        }

        .standards-table tr:hover {
            background: #f8f9fa;
        }

        .test-tabs {
            display: flex;
            margin-bottom: 20px;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .test-tab {
            flex: 1;
            padding: 15px;
            background: #e9ecef;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .test-tab.active {
            background: #8B0000;
            color: #FFD700;
        }

        .hidden {
            display: none;
        }

        .altitude-option {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            border-left: 4px solid #2196f3;
        }

        .altitude-option label {
            margin-bottom: 0;
            font-size: 14px;
            color: #1976d2;
        }

        .altitude-option input[type="checkbox"] {
            width: auto;
            margin-right: 8px;
        }

        /* Score Gauge Styles */
        .score-gauge-container {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 15px;
        }

        .score-gauge {
            position: relative;
            width: 90px;
            height: 90px;
        }

        .score-gauge svg {
            transform: rotate(-90deg);
            width: 90px;
            height: 90px;
        }

        .score-gauge circle {
            fill: none;
            stroke-width: 8;
        }

        .score-gauge .bg {
            stroke: var(--border-color);
        }

        .score-gauge .progress {
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s ease-in-out;
        }

        .score-gauge .gauge-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .score-gauge .gauge-value {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--marine-red);
        }

        [data-theme="dark"] .score-gauge .gauge-value {
            color: var(--marine-gold);
        }

        .score-gauge .gauge-label {
            font-size: 0.65em;
            color: var(--text-secondary);
            max-width: 70px;
            line-height: 1.1;
        }

        /* Points Needed Feedback */
        .improvement-feedback {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #2196f3;
        }

        [data-theme="dark"] .improvement-feedback {
            background: linear-gradient(135deg, #1a2a3a 0%, #1e3a50 100%);
            border-left-color: #4dabf7;
        }

        .improvement-feedback h4 {
            color: #1565c0;
            margin: 0 0 10px 0;
            font-size: 1em;
        }

        [data-theme="dark"] .improvement-feedback h4 {
            color: #74c0fc;
        }

        .improvement-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 5px 0;
            font-size: 0.9em;
            color: var(--text-primary);
        }

        .improvement-item .icon {
            width: 20px;
            text-align: center;
        }

        .improvement-item.achieved {
            color: #2e7d32;
        }

        [data-theme="dark"] .improvement-item.achieved {
            color: #69db7c;
        }

        /* History Panel */
        .history-panel {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            border: 1px solid var(--border-color);
        }

        .history-panel h4 {
            color: var(--marine-red);
            margin: 0 0 15px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        [data-theme="dark"] .history-panel h4 {
            color: var(--marine-gold);
        }

        .history-panel .clear-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8em;
            cursor: pointer;
        }

        .history-panel .clear-btn:hover {
            background: #c82333;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: var(--bg-primary);
            border-radius: 5px;
            margin-bottom: 8px;
            box-shadow: 0 1px 3px var(--card-shadow);
        }

        .history-item:last-child {
            margin-bottom: 0;
        }

        .history-item .date {
            font-size: 0.8em;
            color: var(--text-secondary);
        }

        .history-item .test-type {
            font-weight: bold;
            color: var(--marine-red);
        }

        [data-theme="dark"] .history-item .test-type {
            color: var(--marine-gold);
        }

        .history-item .score {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--text-primary);
        }

        .history-item .classification-badge {
            font-size: 0.75em;
            padding: 2px 8px;
            border-radius: 10px;
            color: white;
        }

        .history-item .classification-badge.body-comp-incentive { background: #17a2b8; }
        .history-item .classification-badge.first-class { background: #28a745; }
        .history-item .classification-badge.second-class { background: #ffc107; color: #333; }
        .history-item .classification-badge.third-class { background: #fd7e14; }
        .history-item .classification-badge.fail { background: #dc3545; }

        .no-history {
            text-align: center;
            color: #666;
            padding: 20px;
            font-style: italic;
        }

        /* Validation Styles */
        .validation-error {
            color: #dc3545;
            font-size: 0.85em;
            margin-top: 5px;
            display: none;
        }

        .form-group input.invalid {
            border-color: #dc3545;
            background-color: #fff5f5;
        }

        .form-group input.valid {
            border-color: #28a745;
        }

        .input-hint {
            font-size: 0.8em;
            color: var(--text-secondary);
            margin-top: 3px;
        }

        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-primary);
            border-radius: 10px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }

        .modal-header {
            background: var(--marine-red);
            color: var(--marine-gold);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 10px 10px 0 0;
        }

        .modal-header h2 {
            font-size: 1.4em;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--marine-gold);
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            line-height: 1;
        }

        .modal-close:hover {
            opacity: 0.8;
        }

        .modal-body {
            padding: 25px;
        }

        .goal-result {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .goal-result h3 {
            color: var(--marine-red);
            margin-bottom: 15px;
        }

        [data-theme="dark"] .goal-result h3 {
            color: var(--marine-gold);
        }

        .goal-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .goal-item:last-child {
            border-bottom: none;
        }

        .goal-item .event-name {
            font-weight: bold;
            color: var(--text-primary);
        }

        .goal-item .requirement {
            color: var(--marine-red);
            font-weight: bold;
        }

        [data-theme="dark"] .goal-item .requirement {
            color: var(--marine-gold);
        }

        /* Action Buttons in Results */
        .result-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .action-btn {
            flex: 1;
            min-width: 120px;
            padding: 10px 15px;
            border: 2px solid var(--marine-red);
            background: transparent;
            color: var(--marine-red);
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .action-btn:hover {
            background: var(--marine-red);
            color: white;
        }

        [data-theme="dark"] .action-btn {
            border-color: var(--marine-gold);
            color: var(--marine-gold);
        }

        [data-theme="dark"] .action-btn:hover {
            background: var(--marine-gold);
            color: var(--marine-red);
        }

        /* Print Styles */
        @media print {
            body {
                background: white !important;
                padding: 0 !important;
            }

            .container {
                box-shadow: none !important;
                max-width: 100% !important;
            }

            .header-buttons,
            .form-section,
            .result-actions,
            .history-panel,
            .improvement-feedback,
            .disclaimer {
                display: none !important;
            }

            .results-section {
                border: none !important;
                width: 100% !important;
                padding: 20px !important;
            }

            .main-content {
                display: block !important;
            }

            .total-score {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            .score-gauge-container {
                page-break-inside: avoid;
            }
        }

        /* PWA Install Banner */
        .install-prompt {
            display: none;
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--marine-red);
            color: var(--marine-gold);
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            z-index: 1001;
            align-items: center;
            gap: 15px;
        }

        .install-prompt.show {
            display: flex;
        }

        .install-prompt button {
            padding: 8px 16px;
            border: 2px solid var(--marine-gold);
            background: transparent;
            color: var(--marine-gold);
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .install-prompt button:hover {
            background: var(--marine-gold);
            color: var(--marine-red);
        }

        .install-prompt .dismiss {
            background: none;
            border: none;
            color: var(--marine-gold);
            cursor: pointer;
            font-size: 20px;
            padding: 0;
            opacity: 0.7;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }

            .form-section,
            .results-section {
                min-width: auto;
            }

            .results-section {
                border-left: none;
                border-top: 3px solid var(--marine-red);
            }

            .radio-group {
                flex-direction: column;
                gap: 10px;
            }

            .time-input {
                flex-wrap: wrap;
            }

            .score-gauge-container {
                justify-content: center;
            }

            .score-gauge {
                width: 80px;
                height: 80px;
            }

            .score-gauge svg {
                width: 80px;
                height: 80px;
            }

            .header-buttons {
                flex-wrap: wrap;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .install-prompt {
                flex-direction: column;
                text-align: center;
                left: 10px;
                right: 10px;
                transform: none;
                width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>USMC PFT & CFT CALCULATOR</h1>
            <p>Physical Fitness Test (PFT) & Combat Fitness Test (CFT) Score Calculator</p>
            <div class="brand">A Product of Semper Admin</div>
            <div class="header-buttons">
                <button class="utility-btn" onclick="toggleDarkMode()" title="Toggle Dark Mode">
                    <span id="theme-icon">ðŸŒ™</span>
                </button>
                <button class="utility-btn" onclick="openGoalCalculator()" title="Goal Calculator">
                    ðŸŽ¯ Goals
                </button>
            </div>
        </div>

        <div class="main-content">
            <div class="form-section">
                <div class="test-tabs">
                    <button class="test-tab active" onclick="switchTest('pft')">PFT</button>
                    <button class="test-tab" onclick="switchTest('cft')">CFT</button>
                </div>

                <div class="form-group">
                    <label for="gender">Gender:</label>
                    <select id="gender">
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="age">Age:</label>
                    <select id="age">
                        <option value="17-20">17-20</option>
                        <option value="21-25">21-25</option>
                        <option value="26-30">26-30</option>
                        <option value="31-35">31-35</option>
                        <option value="36-40">36-40</option>
                        <option value="41-45">41-45</option>
                        <option value="46-50">46-50</option>
                        <option value="51+">51+</option>
                    </select>
                </div>

                <!-- PFT Events -->
                <div id="pft-events">
                    <div class="altitude-option">
                        <label>
                            <input type="checkbox" id="pft-altitude-test"> Conducted at altitude (4,500+ feet MSL)
                        </label>
                    </div>

                    <div class="event-section">
                        <h3>Upper Body Strength</h3>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" name="upper-body" value="pullups" id="pullups" checked onchange="updateUpperBodyHint()">
                                <label for="pullups">Pull-ups</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="upper-body" value="pushups" id="pushups" onchange="updateUpperBodyHint()">
                                <label for="pushups">Push-ups</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="upper-body-reps">Repetitions:</label>
                            <input type="number" id="upper-body-reps" min="0" max="100" placeholder="Enter reps" oninput="validateUpperBody(this)">
                            <div class="input-hint" id="upper-body-hint">Pull-ups: 0-30 typical range</div>
                            <div class="validation-error" id="upper-body-error">Please enter a valid number of repetitions</div>
                        </div>
                    </div>

                    <div class="event-section">
                        <h3>Core Strength - Plank</h3>
                        <div class="form-group">
                            <label>Time (MM:SS):</label>
                            <div class="time-input">
                                <input type="number" id="plank-minutes" min="0" max="5" placeholder="Min" oninput="validatePlank()">
                                <span>:</span>
                                <input type="number" id="plank-seconds" min="0" max="59" placeholder="Sec" oninput="validatePlank()">
                            </div>
                            <div class="input-hint">Max scoring time: 3:45 (100 pts)</div>
                            <div class="validation-error" id="plank-error">Please enter a valid time (0:00 - 5:00)</div>
                        </div>
                    </div>

                    <div class="event-section">
                        <h3>Aerobic Capacity</h3>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" name="cardio-type" value="run" id="run" checked onchange="updateCardioHint()">
                                <label for="run">3-Mile Run</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="cardio-type" value="row" id="row" onchange="updateCardioHint()">
                                <label for="row">5,000m Row</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Time (MM:SS):</label>
                            <div class="time-input">
                                <input type="number" id="cardio-minutes" min="0" max="45" placeholder="Min" oninput="validateCardio()">
                                <span>:</span>
                                <input type="number" id="cardio-seconds" min="0" max="59" placeholder="Sec" oninput="validateCardio()">
                            </div>
                            <div class="input-hint" id="cardio-hint">3-Mile Run: 18:00-33:00 typical range</div>
                            <div class="validation-error" id="cardio-error">Please enter a valid time</div>
                        </div>
                    </div>
                </div>

                <!-- CFT Events -->
                <div id="cft-events" class="hidden">
                    <div class="altitude-option">
                        <label>
                            <input type="checkbox" id="altitude-test"> Conducted at altitude (4,500+ feet MSL)
                        </label>
                    </div>

                    <div class="event-section">
                        <h3>Movement to Contact (MTC)</h3>
                        <div class="form-group">
                            <label>Time (MM:SS):</label>
                            <div class="time-input">
                                <input type="number" id="mtc-minutes" min="0" max="6" placeholder="Min" oninput="validateMTC()">
                                <span>:</span>
                                <input type="number" id="mtc-seconds" min="0" max="59" placeholder="Sec" oninput="validateMTC()">
                            </div>
                            <div class="input-hint">880-yard sprint: 2:40-4:00 typical range</div>
                            <div class="validation-error" id="mtc-error">Please enter a valid time</div>
                        </div>
                    </div>

                    <div class="event-section">
                        <h3>Ammunition Lift (AL)</h3>
                        <div class="form-group">
                            <label for="ammo-lifts">Repetitions:</label>
                            <input type="number" id="ammo-lifts" min="0" max="150" placeholder="Enter reps" oninput="validateAmmoLift(this)">
                            <div class="input-hint">30-lb ammo can lifts: 30-120 typical range</div>
                            <div class="validation-error" id="ammo-error">Please enter a valid number of repetitions</div>
                        </div>
                    </div>

                    <div class="event-section">
                        <h3>Maneuver Under Fire (MANUF)</h3>
                        <div class="form-group">
                            <label>Time (MM:SS):</label>
                            <div class="time-input">
                                <input type="number" id="manuf-minutes" min="0" max="6" placeholder="Min" oninput="validateMANUF()">
                                <span>:</span>
                                <input type="number" id="manuf-seconds" min="0" max="59" placeholder="Sec" oninput="validateMANUF()">
                            </div>
                            <div class="input-hint">300-yard course: 2:00-5:00 typical range</div>
                            <div class="validation-error" id="manuf-error">Please enter a valid time</div>
                        </div>
                    </div>
                </div>

                <button class="calculate-btn" onclick="calculateScore()">CALCULATE SCORE</button>
            </div>

            <div class="results-section">
                <div id="results-display">
                    <div class="results-card">
                        <h3>ðŸ“Š PFT Results</h3>
                        <p>Enter your performance data and click "Calculate Score" to see your results.</p>
                    </div>

                    <div class="standards-table">
                        <h3 style="padding: 15px; margin: 0; background: #8B0000; color: #FFD700;">PFT Performance Standards</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Classification</th>
                                    <th>Score Range</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Body Comp Incentive</strong></td>
                                    <td>250-300</td>
                                </tr>
                                <tr>
                                    <td><strong>1st Class</strong></td>
                                    <td>235-249</td>
                                </tr>
                                <tr>
                                    <td><strong>2nd Class</strong></td>
                                    <td>200-234</td>
                                </tr>
                                <tr>
                                    <td><strong>3rd Class</strong></td>
                                    <td>150-199</td>
                                </tr>
                                <tr>
                                    <td><strong>Failure</strong></td>
                                    <td>Below 150 or failure to meet minimum in any event</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="history-container"></div>
            </div>
        </div>

        <div class="disclaimer">
            <div style="background: #8B0000; color: #FFD700; padding: 15px; border-radius: 5px; margin-bottom: 15px; text-align: center;">
                <strong>Follow Semper Admin on all platforms:</strong><br>
                <a href="https://linktr.ee/semperadmin" target="_blank" style="color: #FFD700; text-decoration: none; font-size: 1.1em; font-weight: bold;">
                    ðŸ”— https://linktr.ee/semperadmin
                </a>
            </div>
            <strong>DISCLAIMER:</strong> This is an unofficial tool for reference purposes only.
            Always refer to official Marine Corps orders and publications for official policy and standards.
            Based on MCO 6100.13A with Administrative Changes. Developed by Semper Admin.
        </div>
    </div>

    <!-- Goal Calculator Modal -->
    <div class="modal-overlay" id="goal-modal">
        <div class="modal">
            <div class="modal-header">
                <h2>ðŸŽ¯ Goal Calculator</h2>
                <button class="modal-close" onclick="closeGoalCalculator()">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 20px; color: var(--text-secondary);">
                    Find out what scores you need to achieve your target classification.
                </p>

                <div class="form-group">
                    <label for="goal-test-type">Test Type:</label>
                    <select id="goal-test-type" onchange="updateGoalForm()">
                        <option value="pft">PFT (Physical Fitness Test)</option>
                        <option value="cft">CFT (Combat Fitness Test)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="goal-gender">Gender:</label>
                    <select id="goal-gender" onchange="calculateGoals()">
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="goal-age">Age Group:</label>
                    <select id="goal-age" onchange="calculateGoals()">
                        <option value="17-20">17-20</option>
                        <option value="21-25">21-25</option>
                        <option value="26-30">26-30</option>
                        <option value="31-35">31-35</option>
                        <option value="36-40">36-40</option>
                        <option value="41-45">41-45</option>
                        <option value="46-50">46-50</option>
                        <option value="51+">51+</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="goal-classification">Target Classification:</label>
                    <select id="goal-classification" onchange="calculateGoals()">
                        <option value="285">285+ (CG's Excellence)</option>
                        <option value="250" selected>Body Comp Incentive (250+)</option>
                        <option value="235">1st Class (235+)</option>
                        <option value="200">2nd Class (200+)</option>
                        <option value="150">3rd Class (150+)</option>
                    </select>
                </div>

                <div id="goal-results"></div>
            </div>
        </div>
    </div>

    <!-- PWA Install Prompt -->
    <div class="install-prompt" id="install-prompt">
        <span>ðŸ“± Install this app for offline use!</span>
        <button onclick="installPWA()">Install</button>
        <button class="dismiss" onclick="dismissInstallPrompt()">&times;</button>
    </div>

    <script>
        // Global variable to track current test
        let currentTest = 'pft';

        // Complete Official USMC PFT Scoring Tables from MCO 6100.13A

        // 3-Mile Run Sea-Level Scoring Table (Table 2-5) - COMPLETE ALL AGE GROUPS
        const runSeaLevelScores = {
            male: {
                '17-20': { '18:00': 100, '18:10': 99, '18:20': 98, '18:30': 97, '18:40': 96, '18:50': 95, '19:00': 94, '19:10': 93, '19:20': 92, '19:30': 91, '19:40': 90, '19:50': 89, '20:00': 88, '20:10': 87, '20:20': 86, '20:30': 84, '20:40': 83, '20:50': 82, '21:00': 81, '21:10': 80, '21:20': 79, '21:30': 78, '21:40': 77, '21:50': 76, '22:00': 75, '22:10': 74, '22:20': 73, '22:30': 72, '22:40': 71, '22:50': 70, '23:00': 69, '23:10': 68, '23:20': 67, '23:30': 66, '23:40': 65, '23:50': 64, '24:00': 63, '24:10': 62, '24:20': 61, '24:30': 60, '24:40': 59, '24:50': 58, '25:00': 57 },
                '21-25': { '18:00': 100, '18:10': 99, '18:20': 98, '18:30': 97, '18:40': 96, '18:50': 95, '19:00': 94, '19:10': 93, '19:20': 92, '19:30': 91, '19:40': 90, '19:50': 89, '20:00': 88, '20:10': 87, '20:20': 86, '20:30': 84, '20:40': 83, '20:50': 82, '21:00': 81, '21:10': 80, '21:20': 79, '21:30': 78, '21:40': 77, '21:50': 76, '22:00': 75, '22:10': 74, '22:20': 73, '22:30': 72, '22:40': 71, '22:50': 70, '23:00': 69, '23:10': 68, '23:20': 67, '23:30': 66, '23:40': 65, '23:50': 64, '24:00': 63, '24:10': 62, '24:20': 61, '24:30': 60, '24:40': 59, '24:50': 58, '25:00': 57 },
                '26-30': { '18:00': 100, '18:20': 98, '18:30': 97, '18:40': 96, '18:50': 95, '19:00': 94, '19:10': 93, '19:20': 92, '19:30': 91, '19:40': 90, '19:50': 89, '20:00': 88, '20:10': 87, '20:20': 86, '20:30': 85, '20:40': 84, '20:50': 83, '21:00': 82, '21:10': 81, '21:20': 80, '21:30': 79, '21:40': 78, '21:50': 77, '22:00': 76, '22:10': 75, '22:20': 74, '22:30': 73, '22:40': 72, '22:50': 71, '23:00': 70, '23:10': 69, '23:20': 68, '23:30': 67, '23:40': 66, '23:50': 65, '24:00': 64, '24:10': 63, '24:20': 62, '24:30': 61, '24:40': 60, '24:50': 59, '25:00': 58 },
                '31-35': { '18:00': 100, '18:20': 98, '18:30': 97, '18:40': 96, '18:50': 95, '19:00': 94, '19:10': 93, '19:20': 92, '19:30': 91, '19:40': 90, '19:50': 89, '20:00': 88, '20:10': 87, '20:20': 86, '20:30': 85, '20:40': 85, '20:50': 84, '21:00': 83, '21:10': 82, '21:20': 81, '21:30': 80, '21:40': 79, '21:50': 78, '22:00': 77, '22:10': 76, '22:20': 75, '22:30': 74, '22:40': 73, '22:50': 72, '23:00': 71, '23:10': 70, '23:20': 69, '23:30': 68, '23:40': 67, '23:50': 66, '24:00': 65, '24:10': 64, '24:20': 63, '24:30': 62, '24:40': 61, '24:50': 60, '25:00': 59 },
                '36-40': { '18:00': 100, '18:30': 100, '18:40': 99, '18:50': 98, '19:00': 97, '19:10': 96, '19:20': 95, '19:30': 94, '19:40': 94, '19:50': 93, '20:00': 92, '20:10': 91, '20:20': 90, '20:30': 89, '20:40': 88, '20:50': 87, '21:00': 86, '21:10': 85, '21:20': 84, '21:30': 83, '21:40': 82, '21:50': 82, '22:00': 81, '22:10': 80, '22:20': 79, '22:30': 78, '22:40': 77, '22:50': 76, '23:00': 75, '23:10': 74, '23:20': 73, '23:30': 72, '23:40': 71, '23:50': 70, '24:00': 69, '24:10': 68, '24:20': 67, '24:30': 67, '24:40': 66, '24:50': 65, '25:00': 64 },
                '41-45': { '18:30': 100, '18:40': 99, '18:50': 98, '19:00': 97, '19:10': 96, '19:20': 95, '19:30': 94, '19:40': 93, '19:50': 95, '20:00': 95, '20:10': 94, '20:20': 93, '20:30': 92, '20:40': 91, '20:50': 90, '21:00': 89, '21:10': 88, '21:20': 87, '21:30': 86, '21:40': 85, '21:50': 85, '22:00': 84, '22:10': 83, '22:20': 82, '22:30': 81, '22:40': 80, '22:50': 79, '23:00': 78, '23:10': 77, '23:20': 76, '23:30': 75, '23:40': 74, '23:50': 73, '24:00': 72, '24:10': 71, '24:20': 70, '24:30': 70, '24:40': 69, '24:50': 68, '25:00': 67 },
                '46-50': { '19:00': 100, '19:10': 99, '19:20': 98, '19:30': 97, '19:40': 96, '19:50': 95, '20:00': 95, '20:10': 94, '20:20': 93, '20:30': 92, '20:40': 91, '20:50': 90, '21:00': 89, '21:10': 88, '21:20': 87, '21:30': 86, '21:40': 85, '21:50': 85, '22:00': 84, '22:10': 83, '22:20': 82, '22:30': 81, '22:40': 80, '22:50': 79, '23:00': 78, '23:10': 77, '23:20': 76, '23:30': 75, '23:40': 74, '23:50': 73, '24:00': 72, '24:10': 71, '24:20': 70, '24:30': 70, '24:40': 69, '24:50': 68, '25:00': 67 },
                '51+': { '19:30': 100, '19:40': 99, '19:50': 98, '20:00': 97, '20:10': 96, '20:20': 95, '20:30': 96, '20:40': 95, '20:50': 94, '21:00': 93, '21:10': 92, '21:20': 91, '21:30': 90, '21:40': 90, '21:50': 89, '22:00': 88, '22:10': 87, '22:20': 86, '22:30': 85, '22:40': 84, '22:50': 84, '23:00': 83, '23:10': 82, '23:20': 81, '23:30': 80, '23:40': 79, '23:50': 78, '24:00': 77, '24:10': 76, '24:20': 75, '24:30': 74, '24:40': 73, '24:50': 72, '25:00': 71 }
            },
            female: {
                '17-20': { '21:00': 100, '21:10': 99, '21:20': 98, '21:30': 97, '21:40': 96, '21:50': 95, '22:00': 94, '22:10': 93, '22:20': 92, '22:30': 91, '22:40': 90, '22:50': 89, '23:00': 88, '23:10': 87, '23:20': 86, '23:30': 85, '23:40': 84, '23:50': 83, '24:00': 82, '24:10': 81, '24:20': 80, '24:30': 79, '24:40': 78, '24:50': 77, '25:00': 76, '25:10': 75, '25:20': 74, '25:30': 73, '25:40': 72, '25:50': 71, '26:00': 70, '26:10': 68, '26:20': 67, '26:30': 66, '26:40': 65, '26:50': 64, '27:00': 63, '27:10': 62, '27:20': 61, '27:30': 60, '27:40': 59, '27:50': 58, '28:00': 57 },
                '21-25': { '21:00': 100, '21:10': 99, '21:20': 98, '21:30': 97, '21:40': 96, '21:50': 95, '22:00': 94, '22:10': 93, '22:20': 92, '22:30': 91, '22:40': 90, '22:50': 89, '23:00': 88, '23:10': 87, '23:20': 86, '23:30': 85, '23:40': 84, '23:50': 83, '24:00': 82, '24:10': 81, '24:20': 80, '24:30': 79, '24:40': 78, '24:50': 77, '25:00': 76, '25:10': 75, '25:20': 74, '25:30': 73, '25:40': 72, '25:50': 71, '26:00': 70, '26:10': 68, '26:20': 67, '26:30': 66, '26:40': 65, '26:50': 64, '27:00': 63, '27:10': 62, '27:20': 61, '27:30': 60, '27:40': 59, '27:50': 58, '28:00': 57 },
                '26-30': { '21:00': 100, '21:20': 98, '21:30': 97, '21:40': 96, '21:50': 95, '22:00': 94, '22:10': 93, '22:20': 92, '22:30': 91, '22:40': 90, '22:50': 89, '23:00': 88, '23:10': 87, '23:20': 86, '23:30': 85, '23:40': 84, '23:50': 83, '24:00': 82, '24:10': 81, '24:20': 80, '24:30': 79, '24:40': 78, '24:50': 77, '25:00': 76, '25:10': 75, '25:20': 74, '25:30': 73, '25:40': 72, '25:50': 71, '26:00': 70, '26:10': 69, '26:20': 68, '26:30': 67, '26:40': 66, '26:50': 65, '27:00': 64, '27:10': 63, '27:20': 62, '27:30': 61, '27:40': 60, '27:50': 59, '28:00': 58 },
                '31-35': { '21:00': 100, '21:20': 98, '21:30': 97, '21:40': 96, '21:50': 95, '22:00': 94, '22:10': 93, '22:20': 92, '22:30': 91, '22:40': 90, '22:50': 89, '23:00': 88, '23:10': 87, '23:20': 86, '23:30': 85, '23:40': 84, '23:50': 83, '24:00': 82, '24:10': 81, '24:20': 80, '24:30': 79, '24:40': 78, '24:50': 77, '25:00': 76, '25:10': 75, '25:20': 74, '25:30': 73, '25:40': 72, '25:50': 71, '26:00': 70, '26:10': 69, '26:20': 68, '26:30': 67, '26:40': 66, '26:50': 65, '27:00': 64, '27:10': 63, '27:20': 62, '27:30': 61, '27:40': 60, '27:50': 59, '28:00': 58 },
                '36-40': { '21:30': 100, '21:40': 99, '21:50': 98, '22:00': 97, '22:10': 96, '22:20': 95, '22:30': 94, '22:40': 93, '22:50': 92, '23:00': 91, '23:10': 90, '23:20': 89, '23:30': 88, '23:40': 87, '23:50': 86, '24:00': 85, '24:10': 84, '24:20': 83, '24:30': 82, '24:40': 81, '24:50': 80, '25:00': 79, '25:10': 78, '25:20': 77, '25:30': 76, '25:40': 75, '25:50': 74, '26:00': 73, '26:10': 72, '26:20': 71, '26:30': 70, '26:40': 69, '26:50': 68, '27:00': 67, '27:10': 66, '27:20': 65, '27:30': 64, '27:40': 63, '27:50': 62, '28:00': 61 },
                '41-45': { '22:00': 100, '22:10': 99, '22:20': 98, '22:30': 97, '22:40': 96, '22:50': 95, '23:00': 94, '23:10': 93, '23:20': 92, '23:30': 91, '23:40': 90, '23:50': 89, '24:00': 88, '24:10': 87, '24:20': 86, '24:30': 85, '24:40': 84, '24:50': 83, '25:00': 82, '25:10': 81, '25:20': 80, '25:30': 79, '25:40': 78, '25:50': 77, '26:00': 76, '26:10': 75, '26:20': 74, '26:30': 73, '26:40': 72, '26:50': 71, '27:00': 70, '27:10': 69, '27:20': 68, '27:30': 67, '27:40': 66, '27:50': 65, '28:00': 64 },
                '46-50': { '22:30': 100, '22:40': 99, '22:50': 98, '23:00': 97, '23:10': 96, '23:20': 95, '23:30': 94, '23:40': 93, '23:50': 92, '24:00': 91, '24:10': 90, '24:20': 89, '24:30': 88, '24:40': 87, '24:50': 86, '25:00': 85, '25:10': 84, '25:20': 83, '25:30': 82, '25:40': 81, '25:50': 80, '26:00': 79, '26:10': 78, '26:20': 77, '26:30': 76, '26:40': 75, '26:50': 74, '27:00': 73, '27:10': 72, '27:20': 71, '27:30': 70, '27:40': 69, '27:50': 68, '28:00': 67 },
                '51+': { '22:30': 100, '22:40': 99, '22:50': 98, '23:00': 97, '23:10': 96, '23:20': 95, '23:30': 94, '23:40': 93, '23:50': 92, '24:00': 91, '24:10': 90, '24:20': 89, '24:30': 88, '24:40': 87, '24:50': 86, '25:00': 85, '25:10': 84, '25:20': 83, '25:30': 82, '25:40': 81, '25:50': 80, '26:00': 79, '26:10': 78, '26:20': 77, '26:30': 76, '26:40': 75, '26:50': 74, '27:00': 73, '27:10': 72, '27:20': 71, '27:30': 70, '27:40': 69, '27:50': 68, '28:00': 67 }
            }
        };

        // 3-Mile Run Altitude Compensation Table (Table 2-6) - COMPLETE ALL AGE GROUPS
        const runAltitudeScores = {
            male: {
                '17-20': { '19:30': 100, '19:40': 99, '19:50': 98, '20:00': 97, '20:10': 96, '20:20': 95, '20:30': 94, '20:40': 93, '20:50': 92, '21:00': 91, '21:10': 90, '21:20': 89, '21:30': 88, '21:40': 87, '21:50': 86, '22:00': 84, '22:10': 83, '22:20': 82, '22:30': 81, '22:40': 80, '22:50': 79, '23:00': 78, '23:10': 77, '23:20': 76, '23:30': 75, '23:40': 74, '23:50': 73, '24:00': 72, '24:10': 71, '24:20': 70, '24:30': 69, '24:40': 68, '24:50': 67, '25:00': 66, '25:10': 65, '25:20': 64, '25:30': 63, '25:40': 62, '25:50': 61, '26:00': 60, '26:10': 59, '26:20': 58, '26:30': 57 },
                '21-25': { '19:30': 100, '19:40': 99, '19:50': 98, '20:00': 97, '20:10': 96, '20:20': 95, '20:30': 94, '20:40': 93, '20:50': 92, '21:00': 91, '21:10': 90, '21:20': 89, '21:30': 88, '21:40': 87, '21:50': 86, '22:00': 84, '22:10': 83, '22:20': 82, '22:30': 81, '22:40': 80, '22:50': 79, '23:00': 78, '23:10': 77, '23:20': 76, '23:30': 75, '23:40': 74, '23:50': 73, '24:00': 72, '24:10': 71, '24:20': 70, '24:30': 69, '24:40': 68, '24:50': 67, '25:00': 66, '25:10': 65, '25:20': 64, '25:30': 63, '25:40': 62, '25:50': 61, '26:00': 60, '26:10': 59, '26:20': 58, '26:30': 57 },
                '26-30': { '19:30': 100, '19:50': 98, '20:00': 97, '20:10': 96, '20:20': 95, '20:30': 94, '20:40': 93, '20:50': 92, '21:00': 91, '21:10': 90, '21:20': 89, '21:30': 88, '21:40': 87, '21:50': 86, '22:00': 85, '22:10': 84, '22:20': 83, '22:30': 82, '22:40': 81, '22:50': 80, '23:00': 79, '23:10': 78, '23:20': 77, '23:30': 76, '23:40': 75, '23:50': 74, '24:00': 73, '24:10': 72, '24:20': 71, '24:30': 70, '24:40': 69, '24:50': 68, '25:00': 67, '25:10': 66, '25:20': 65, '25:30': 64, '25:40': 63, '25:50': 62, '26:00': 61, '26:10': 60, '26:20': 59, '26:30': 58 },
                '31-35': { '19:30': 100, '19:50': 98, '20:00': 97, '20:10': 96, '20:20': 95, '20:30': 94, '20:40': 93, '20:50': 92, '21:00': 91, '21:10': 90, '21:20': 89, '21:30': 88, '21:40': 87, '21:50': 86, '22:00': 85, '22:10': 85, '22:20': 84, '22:30': 83, '22:40': 82, '22:50': 81, '23:00': 80, '23:10': 79, '23:20': 78, '23:30': 77, '23:40': 76, '23:50': 75, '24:00': 74, '24:10': 73, '24:20': 72, '24:30': 71, '24:40': 70, '24:50': 69, '25:00': 68, '25:10': 67, '25:20': 66, '25:30': 65, '25:40': 64, '25:50': 63, '26:00': 62, '26:10': 61, '26:20': 60, '26:30': 59 },
                '36-40': { '19:30': 100, '20:00': 100, '20:10': 99, '20:20': 98, '20:30': 97, '20:40': 96, '20:50': 95, '21:00': 94, '21:10': 94, '21:20': 93, '21:30': 92, '21:40': 91, '21:50': 90, '22:00': 89, '22:10': 88, '22:20': 87, '22:30': 86, '22:40': 85, '22:50': 84, '23:00': 83, '23:10': 82, '23:20': 82, '23:30': 81, '23:40': 80, '23:50': 79, '24:00': 78, '24:10': 77, '24:20': 76, '24:30': 75, '24:40': 74, '24:50': 73, '25:00': 72, '25:10': 71, '25:20': 70, '25:30': 69, '25:40': 68, '25:50': 67, '26:00': 67, '26:10': 66, '26:20': 65, '26:30': 64 },
                '41-45': { '20:00': 100, '20:10': 99, '20:20': 98, '20:30': 97, '20:40': 96, '20:50': 95, '21:00': 94, '21:10': 93, '21:20': 95, '21:30': 95, '21:40': 94, '21:50': 93, '22:00': 92, '22:10': 91, '22:20': 90, '22:30': 89, '22:40': 88, '22:50': 87, '23:00': 86, '23:10': 85, '23:20': 85, '23:30': 84, '23:40': 83, '23:50': 82, '24:00': 81, '24:10': 80, '24:20': 79, '24:30': 78, '24:40': 77, '24:50': 76, '25:00': 75, '25:10': 74, '25:20': 73, '25:30': 72, '25:40': 71, '25:50': 70, '26:00': 70, '26:10': 69, '26:20': 68, '26:30': 67 },
                '46-50': { '20:30': 100, '20:40': 99, '20:50': 98, '21:00': 97, '21:10': 96, '21:20': 95, '21:30': 95, '21:40': 94, '21:50': 93, '22:00': 92, '22:10': 91, '22:20': 90, '22:30': 89, '22:40': 88, '22:50': 87, '23:00': 86, '23:10': 85, '23:20': 85, '23:30': 84, '23:40': 83, '23:50': 82, '24:00': 81, '24:10': 80, '24:20': 79, '24:30': 78, '24:40': 77, '24:50': 76, '25:00': 75, '25:10': 74, '25:20': 73, '25:30': 72, '25:40': 71, '25:50': 70, '26:00': 70, '26:10': 69, '26:20': 68, '26:30': 67 },
                '51+': { '21:00': 100, '21:10': 99, '21:20': 98, '21:30': 97, '21:40': 96, '21:50': 95, '22:00': 96, '22:10': 95, '22:20': 94, '22:30': 93, '22:40': 92, '22:50': 91, '23:00': 90, '23:10': 90, '23:20': 89, '23:30': 88, '23:40': 87, '23:50': 86, '24:00': 85, '24:10': 84, '24:20': 84, '24:30': 83, '24:40': 82, '24:50': 81, '25:00': 80, '25:10': 79, '25:20': 78, '25:30': 77, '25:40': 76, '25:50': 75, '26:00': 74, '26:10': 73, '26:20': 72, '26:30': 71 }
            },
            female: {
                '17-20': { '22:30': 100, '22:40': 99, '22:50': 98, '23:00': 97, '23:10': 96, '23:20': 95, '23:30': 94, '23:40': 93, '23:50': 92, '24:00': 91, '24:10': 90, '24:20': 89, '24:30': 88, '24:40': 87, '24:50': 86, '25:00': 85, '25:10': 84, '25:20': 83, '25:30': 82, '25:40': 81, '25:50': 80, '26:00': 79, '26:10': 78, '26:20': 77, '26:30': 76, '26:40': 75, '26:50': 74, '27:00': 73, '27:10': 72, '27:20': 71, '27:30': 70, '27:40': 68, '27:50': 67, '28:00': 66, '28:10': 65, '28:20': 64, '28:30': 63, '28:40': 62, '28:50': 61, '29:00': 60, '29:10': 59, '29:20': 58, '29:30': 57 },
                '21-25': { '22:30': 100, '22:40': 99, '22:50': 98, '23:00': 97, '23:10': 96, '23:20': 95, '23:30': 94, '23:40': 93, '23:50': 92, '24:00': 91, '24:10': 90, '24:20': 89, '24:30': 88, '24:40': 87, '24:50': 86, '25:00': 85, '25:10': 84, '25:20': 83, '25:30': 82, '25:40': 81, '25:50': 80, '26:00': 79, '26:10': 78, '26:20': 77, '26:30': 76, '26:40': 75, '26:50': 74, '27:00': 73, '27:10': 72, '27:20': 71, '27:30': 70, '27:40': 68, '27:50': 67, '28:00': 66, '28:10': 65, '28:20': 64, '28:30': 63, '28:40': 62, '28:50': 61, '29:00': 60, '29:10': 59, '29:20': 58, '29:30': 57 },
                '26-30': { '22:30': 100, '22:50': 98, '23:00': 97, '23:10': 96, '23:20': 95, '23:30': 94, '23:40': 93, '23:50': 92, '24:00': 91, '24:10': 90, '24:20': 89, '24:30': 88, '24:40': 87, '24:50': 86, '25:00': 85, '25:10': 84, '25:20': 83, '25:30': 82, '25:40': 81, '25:50': 80, '26:00': 79, '26:10': 78, '26:20': 77, '26:30': 76, '26:40': 75, '26:50': 74, '27:00': 73, '27:10': 72, '27:20': 71, '27:30': 70, '27:40': 69, '27:50': 68, '28:00': 67, '28:10': 66, '28:20': 65, '28:30': 64, '28:40': 63, '28:50': 62, '29:00': 61, '29:10': 60, '29:20': 59, '29:30': 58 },
                '31-35': { '22:30': 100, '22:50': 98, '23:00': 97, '23:10': 96, '23:20': 95, '23:30': 94, '23:40': 93, '23:50': 92, '24:00': 91, '24:10': 90, '24:20': 89, '24:30': 88, '24:40': 87, '24:50': 86, '25:00': 85, '25:10': 84, '25:20': 83, '25:30': 82, '25:40': 81, '25:50': 80, '26:00': 79, '26:10': 78, '26:20': 77, '26:30': 76, '26:40': 75, '26:50': 74, '27:00': 73, '27:10': 72, '27:20': 71, '27:30': 70, '27:40': 69, '27:50': 68, '28:00': 67, '28:10': 66, '28:20': 65, '28:30': 64, '28:40': 63, '28:50': 62, '29:00': 61, '29:10': 60, '29:20': 59, '29:30': 58 },
                '36-40': { '23:00': 100, '23:10': 99, '23:20': 98, '23:30': 97, '23:40': 96, '23:50': 95, '24:00': 94, '24:10': 93, '24:20': 92, '24:30': 91, '24:40': 90, '24:50': 89, '25:00': 88, '25:10': 87, '25:20': 86, '25:30': 85, '25:40': 84, '25:50': 83, '26:00': 82, '26:10': 81, '26:20': 80, '26:30': 79, '26:40': 78, '26:50': 77, '27:00': 76, '27:10': 75, '27:20': 74, '27:30': 73, '27:40': 72, '27:50': 71, '28:00': 70, '28:10': 69, '28:20': 68, '28:30': 67, '28:40': 66, '28:50': 65, '29:00': 64, '29:10': 63, '29:20': 62, '29:30': 61 },
                '41-45': { '23:30': 100, '23:40': 99, '23:50': 98, '24:00': 97, '24:10': 96, '24:20': 95, '24:30': 94, '24:40': 93, '24:50': 92, '25:00': 91, '25:10': 90, '25:20': 89, '25:30': 88, '25:40': 87, '25:50': 86, '26:00': 85, '26:10': 84, '26:20': 83, '26:30': 82, '26:40': 81, '26:50': 80, '27:00': 79, '27:10': 78, '27:20': 77, '27:30': 76, '27:40': 75, '27:50': 74, '28:00': 73, '28:10': 72, '28:20': 71, '28:30': 70, '28:40': 69, '28:50': 68, '29:00': 67, '29:10': 66, '29:20': 65, '29:30': 64 },
                '46-50': { '24:00': 100, '24:10': 99, '24:20': 98, '24:30': 97, '24:40': 96, '24:50': 95, '25:00': 94, '25:10': 93, '25:20': 92, '25:30': 91, '25:40': 90, '25:50': 89, '26:00': 88, '26:10': 87, '26:20': 86, '26:30': 85, '26:40': 84, '26:50': 83, '27:00': 82, '27:10': 81, '27:20': 80, '27:30': 79, '27:40': 78, '27:50': 77, '28:00': 76, '28:10': 75, '28:20': 74, '28:30': 73, '28:40': 72, '28:50': 71, '29:00': 70, '29:10': 69, '29:20': 68, '29:30': 67 },
                '51+': { '24:00': 100, '24:10': 99, '24:20': 98, '24:30': 97, '24:40': 96, '24:50': 95, '25:00': 94, '25:10': 93, '25:20': 92, '25:30': 91, '25:40': 90, '25:50': 89, '26:00': 88, '26:10': 87, '26:20': 86, '26:30': 85, '26:40': 84, '26:50': 83, '27:00': 82, '27:10': 81, '27:20': 80, '27:30': 79, '27:40': 78, '27:50': 77, '28:00': 76, '28:10': 75, '28:20': 74, '28:30': 73, '28:40': 72, '28:50': 71, '29:00': 70, '29:10': 69, '29:20': 68, '29:30': 67 }
            }
        };

        // 5,000m Row Scoring Table (Table 2-7) - Sea Level - COMPLETE ALL AGE GROUPS
        const rowSeaLevelScores = {
            male: {
                '17-20': { '18:00': 100, '18:05': 99, '18:10': 98, '18:15': 97, '18:20': 96, '18:25': 95, '18:30': 95, '18:35': 94, '18:40': 93, '18:45': 92, '18:50': 91, '18:55': 90, '19:00': 89, '19:05': 88, '19:10': 87, '19:15': 86, '19:20': 85, '19:25': 85, '19:30': 84, '19:35': 83, '19:40': 82, '19:45': 81, '19:50': 80, '19:55': 79, '20:00': 78, '20:05': 77, '20:10': 76, '20:15': 75, '20:20': 75, '20:25': 74, '20:30': 73, '20:35': 72, '20:40': 71, '20:45': 70, '20:50': 69, '20:55': 68, '21:00': 67, '21:05': 66, '21:10': 65, '21:15': 65, '21:20': 64, '21:25': 63, '21:30': 62, '21:35': 61, '21:40': 60, '21:45': 59, '21:50': 58, '21:55': 57 },
                '21-25': { '18:15': 100, '18:20': 99, '18:25': 98, '18:30': 97, '18:35': 96, '18:40': 95, '18:45': 94, '18:50': 93, '18:55': 92, '19:00': 91, '19:05': 90, '19:10': 89, '19:15': 88, '19:20': 87, '19:25': 86, '19:30': 85, '19:35': 84, '19:40': 83, '19:45': 82, '19:50': 81, '19:55': 80, '20:00': 79, '20:05': 78, '20:10': 77, '20:15': 76, '20:20': 75, '20:25': 74, '20:30': 73, '20:35': 72, '20:40': 71, '20:45': 70, '20:50': 69, '20:55': 68, '21:00': 67, '21:05': 66, '21:10': 65, '21:15': 64, '21:20': 63, '21:25': 62, '21:30': 61, '21:35': 60, '21:40': 59, '21:45': 58, '21:50': 57, '21:55': 56 },
                '26-30': { '18:30': 100, '18:35': 99, '18:40': 98, '18:45': 97, '18:50': 96, '18:55': 95, '19:00': 94, '19:05': 93, '19:10': 92, '19:15': 91, '19:20': 90, '19:25': 89, '19:30': 88, '19:35': 87, '19:40': 86, '19:45': 85, '19:50': 84, '19:55': 83, '20:00': 82, '20:05': 81, '20:10': 80, '20:15': 79, '20:20': 78, '20:25': 77, '20:30': 76, '20:35': 75, '20:40': 74, '20:45': 73, '20:50': 72, '20:55': 71, '21:00': 70, '21:05': 69, '21:10': 68, '21:15': 67, '21:20': 66, '21:25': 65, '21:30': 64, '21:35': 63, '21:40': 62, '21:45': 61, '21:50': 60, '21:55': 59 },
                '31-35': { '18:45': 100, '18:50': 99, '18:55': 98, '19:00': 97, '19:05': 96, '19:10': 95, '19:15': 94, '19:20': 93, '19:25': 92, '19:30': 91, '19:35': 90, '19:40': 89, '19:45': 88, '19:50': 87, '19:55': 86, '20:00': 85, '20:05': 84, '20:10': 83, '20:15': 82, '20:20': 81, '20:25': 80, '20:30': 79, '20:35': 78, '20:40': 77, '20:45': 76, '20:50': 75, '20:55': 74, '21:00': 73, '21:05': 72, '21:10': 71, '21:15': 70, '21:20': 69, '21:25': 68, '21:30': 67, '21:35': 66, '21:40': 65, '21:45': 64, '21:50': 63, '21:55': 62 },
                '36-40': { '19:00': 100, '19:05': 99, '19:10': 98, '19:15': 97, '19:20': 96, '19:25': 95, '19:30': 94, '19:35': 93, '19:40': 92, '19:45': 91, '19:50': 90, '19:55': 89, '20:00': 88, '20:05': 87, '20:10': 86, '20:15': 85, '20:20': 84, '20:25': 83, '20:30': 82, '20:35': 81, '20:40': 80, '20:45': 79, '20:50': 78, '20:55': 77, '21:00': 76, '21:05': 75, '21:10': 74, '21:15': 73, '21:20': 72, '21:25': 71, '21:30': 70, '21:35': 69, '21:40': 68, '21:45': 67, '21:50': 66, '21:55': 65 },
                '41-45': { '19:15': 100, '19:20': 99, '19:25': 98, '19:30': 97, '19:35': 96, '19:40': 95, '19:45': 94, '19:50': 93, '19:55': 92, '20:00': 91, '20:05': 90, '20:10': 89, '20:15': 88, '20:20': 87, '20:25': 86, '20:30': 85, '20:35': 84, '20:40': 83, '20:45': 82, '20:50': 81, '20:55': 80, '21:00': 79, '21:05': 78, '21:10': 77, '21:15': 76, '21:20': 75, '21:25': 74, '21:30': 73, '21:35': 72, '21:40': 71, '21:45': 70, '21:50': 69, '21:55': 68 },
                '46-50': { '19:35': 100, '19:40': 99, '19:45': 98, '19:50': 97, '19:55': 96, '20:00': 95, '20:05': 94, '20:10': 93, '20:15': 92, '20:20': 91, '20:25': 90, '20:30': 89, '20:35': 88, '20:40': 87, '20:45': 86, '20:50': 85, '20:55': 84, '21:00': 83, '21:05': 82, '21:10': 81, '21:15': 80, '21:20': 79, '21:25': 78, '21:30': 77, '21:35': 76, '21:40': 75, '21:45': 74, '21:50': 73, '21:55': 72 },
                '51+': { '20:00': 100, '20:05': 99, '20:10': 98, '20:15': 97, '20:20': 96, '20:25': 95, '20:30': 94, '20:35': 93, '20:40': 92, '20:45': 91, '20:50': 90, '20:55': 89, '21:00': 88, '21:05': 87, '21:10': 86, '21:15': 85, '21:20': 84, '21:25': 83, '21:30': 82, '21:35': 81, '21:40': 80, '21:45': 79, '21:50': 78, '21:55': 77 }
            },
            female: {
                '17-20': { '21:00': 100, '21:05': 99, '21:10': 98, '21:15': 97, '21:20': 96, '21:25': 95, '21:30': 95, '21:35': 94, '21:40': 93, '21:45': 92, '21:50': 91, '21:55': 90, '22:00': 89, '22:05': 88, '22:10': 87, '22:15': 86, '22:20': 85, '22:25': 85, '22:30': 84, '22:35': 83, '22:40': 82, '22:45': 81, '22:50': 80, '22:55': 79, '23:00': 78, '23:05': 77, '23:10': 76, '23:15': 75, '23:20': 75, '23:25': 74, '23:30': 73, '23:35': 72, '23:40': 71, '23:45': 70, '23:50': 69, '23:55': 68, '24:00': 67, '24:05': 66, '24:10': 65, '24:15': 65, '24:20': 64, '24:25': 63, '24:30': 62, '24:35': 61, '24:40': 60, '24:45': 59, '24:50': 58, '24:55': 57 },
                '21-25': { '21:15': 100, '21:20': 99, '21:25': 98, '21:30': 97, '21:35': 96, '21:40': 95, '21:45': 94, '21:50': 93, '21:55': 92, '22:00': 91, '22:05': 90, '22:10': 89, '22:15': 88, '22:20': 87, '22:25': 86, '22:30': 85, '22:35': 84, '22:40': 83, '22:45': 82, '22:50': 81, '22:55': 80, '23:00': 79, '23:05': 78, '23:10': 77, '23:15': 76, '23:20': 75, '23:25': 74, '23:30': 73, '23:35': 72, '23:40': 71, '23:45': 70, '23:50': 69, '23:55': 68, '24:00': 67, '24:05': 66, '24:10': 65, '24:15': 64, '24:20': 63, '24:25': 62, '24:30': 61, '24:35': 60, '24:40': 59, '24:45': 58, '24:50': 57, '24:55': 56 },
                '26-30': { '21:30': 100, '21:35': 99, '21:40': 98, '21:45': 97, '21:50': 96, '21:55': 95, '22:00': 94, '22:05': 93, '22:10': 92, '22:15': 91, '22:20': 90, '22:25': 89, '22:30': 88, '22:35': 87, '22:40': 86, '22:45': 85, '22:50': 84, '22:55': 83, '23:00': 82, '23:05': 81, '23:10': 80, '23:15': 79, '23:20': 78, '23:25': 77, '23:30': 76, '23:35': 75, '23:40': 74, '23:45': 73, '23:50': 72, '23:55': 71, '24:00': 70, '24:05': 69, '24:10': 68, '24:15': 67, '24:20': 66, '24:25': 65, '24:30': 64, '24:35': 63, '24:40': 62, '24:45': 61, '24:50': 60, '24:55': 59 },
                '31-35': { '21:45': 100, '21:50': 99, '21:55': 98, '22:00': 97, '22:05': 96, '22:10': 95, '22:15': 94, '22:20': 93, '22:25': 92, '22:30': 91, '22:35': 90, '22:40': 89, '22:45': 88, '22:50': 87, '22:55': 86, '23:00': 85, '23:05': 84, '23:10': 83, '23:15': 82, '23:20': 81, '23:25': 80, '23:30': 79, '23:35': 78, '23:40': 77, '23:45': 76, '23:50': 75, '23:55': 74, '24:00': 73, '24:05': 72, '24:10': 71, '24:15': 70, '24:20': 69, '24:25': 68, '24:30': 67, '24:35': 66, '24:40': 65, '24:45': 64, '24:50': 63, '24:55': 62 },
                '36-40': { '22:00': 100, '22:05': 99, '22:10': 98, '22:15': 97, '22:20': 96, '22:25': 95, '22:30': 94, '22:35': 93, '22:40': 92, '22:45': 91, '22:50': 90, '22:55': 89, '23:00': 88, '23:05': 87, '23:10': 86, '23:15': 85, '23:20': 84, '23:25': 83, '23:30': 82, '23:35': 81, '23:40': 80, '23:45': 79, '23:50': 78, '23:55': 77, '24:00': 76, '24:05': 75, '24:10': 74, '24:15': 73, '24:20': 72, '24:25': 71, '24:30': 70, '24:35': 69, '24:40': 68, '24:45': 67, '24:50': 66, '24:55': 65 },
                '41-45': { '22:15': 100, '22:20': 99, '22:25': 98, '22:30': 97, '22:35': 96, '22:40': 95, '22:45': 94, '22:50': 93, '22:55': 92, '23:00': 91, '23:05': 90, '23:10': 89, '23:15': 88, '23:20': 87, '23:25': 86, '23:30': 85, '23:35': 84, '23:40': 83, '23:45': 82, '23:50': 81, '23:55': 80, '24:00': 79, '24:05': 78, '24:10': 77, '24:15': 76, '24:20': 75, '24:25': 74, '24:30': 73, '24:35': 72, '24:40': 71, '24:45': 70, '24:50': 69, '24:55': 68 },
                '46-50': { '22:35': 100, '22:40': 99, '22:45': 98, '22:50': 97, '22:55': 96, '23:00': 95, '23:05': 94, '23:10': 93, '23:15': 92, '23:20': 91, '23:25': 90, '23:30': 89, '23:35': 88, '23:40': 87, '23:45': 86, '23:50': 85, '23:55': 84, '24:00': 83, '24:05': 82, '24:10': 81, '24:15': 80, '24:20': 79, '24:25': 78, '24:30': 77, '24:35': 76, '24:40': 75, '24:45': 74, '24:50': 73, '24:55': 72 },
                '51+': { '23:00': 100, '23:05': 99, '23:10': 98, '23:15': 97, '23:20': 96, '23:25': 95, '23:30': 94, '23:35': 93, '23:40': 92, '23:45': 91, '23:50': 90, '23:55': 89, '24:00': 88, '24:05': 87, '24:10': 86, '24:15': 85, '24:20': 84, '24:25': 83, '24:30': 82, '24:35': 81, '24:40': 80, '24:45': 79, '24:50': 78, '24:55': 77 }
            }
        };

        // 5,000m Row Altitude Scoring Table (Table 2-8) - COMPLETE ALL AGE GROUPS
        const rowAltitudeScores = {
            male: {
                '17-20': { '18:40': 100, '18:45': 99, '18:50': 98, '18:55': 97, '19:00': 96, '19:05': 95, '19:10': 95, '19:15': 94, '19:20': 93, '19:25': 92, '19:30': 91, '19:35': 90, '19:40': 89, '19:45': 88, '19:50': 87, '19:55': 86, '20:00': 85, '20:05': 85, '20:10': 84, '20:15': 83, '20:20': 82, '20:25': 81, '20:30': 80, '20:35': 79, '20:40': 78, '20:45': 77, '20:50': 76, '20:55': 75, '21:00': 75, '21:05': 74, '21:10': 73, '21:15': 72, '21:20': 71, '21:25': 70, '21:30': 69, '21:35': 68, '21:40': 67, '21:45': 66, '21:50': 65, '21:55': 64, '22:00': 63, '22:05': 62, '22:10': 61, '22:15': 60, '22:20': 59, '22:25': 58, '22:30': 57, '22:35': 56, '22:40': 55 },
                '21-25': { '18:55': 100, '19:00': 99, '19:05': 98, '19:10': 97, '19:15': 96, '19:20': 95, '19:25': 94, '19:30': 93, '19:35': 92, '19:40': 91, '19:45': 90, '19:50': 89, '19:55': 88, '20:00': 87, '20:05': 86, '20:10': 85, '20:15': 84, '20:20': 83, '20:25': 82, '20:30': 81, '20:35': 80, '20:40': 79, '20:45': 78, '20:50': 77, '20:55': 76, '21:00': 75, '21:05': 74, '21:10': 73, '21:15': 72, '21:20': 71, '21:25': 70, '21:30': 69, '21:35': 68, '21:40': 67, '21:45': 66, '21:50': 65, '21:55': 64, '22:00': 63, '22:05': 62, '22:10': 61, '22:15': 60, '22:20': 59, '22:25': 58, '22:30': 57, '22:35': 56, '22:40': 55 },
                '26-30': { '19:10': 100, '19:15': 99, '19:20': 98, '19:25': 97, '19:30': 96, '19:35': 95, '19:40': 94, '19:45': 93, '19:50': 92, '19:55': 91, '20:00': 90, '20:05': 89, '20:10': 88, '20:15': 87, '20:20': 86, '20:25': 85, '20:30': 84, '20:35': 83, '20:40': 82, '20:45': 81, '20:50': 80, '20:55': 79, '21:00': 78, '21:05': 77, '21:10': 76, '21:15': 75, '21:20': 74, '21:25': 73, '21:30': 72, '21:35': 71, '21:40': 70, '21:45': 69, '21:50': 68, '21:55': 67, '22:00': 66, '22:05': 65, '22:10': 64, '22:15': 63, '22:20': 62, '22:25': 61, '22:30': 60, '22:35': 59, '22:40': 58 },
                '31-35': { '19:25': 100, '19:30': 99, '19:35': 98, '19:40': 97, '19:45': 96, '19:50': 95, '19:55': 94, '20:00': 93, '20:05': 92, '20:10': 91, '20:15': 90, '20:20': 89, '20:25': 88, '20:30': 87, '20:35': 86, '20:40': 85, '20:45': 84, '20:50': 83, '20:55': 82, '21:00': 81, '21:05': 80, '21:10': 79, '21:15': 78, '21:20': 77, '21:25': 76, '21:30': 75, '21:35': 74, '21:40': 73, '21:45': 72, '21:50': 71, '21:55': 70, '22:00': 69, '22:05': 68, '22:10': 67, '22:15': 66, '22:20': 65, '22:25': 64, '22:30': 63, '22:35': 62, '22:40': 61 },
                '36-40': { '19:40': 100, '19:45': 99, '19:50': 98, '19:55': 97, '20:00': 96, '20:05': 95, '20:10': 94, '20:15': 93, '20:20': 92, '20:25': 91, '20:30': 90, '20:35': 89, '20:40': 88, '20:45': 87, '20:50': 86, '20:55': 85, '21:00': 84, '21:05': 83, '21:10': 82, '21:15': 81, '21:20': 80, '21:25': 79, '21:30': 78, '21:35': 77, '21:40': 76, '21:45': 75, '21:50': 74, '21:55': 73, '22:00': 72, '22:05': 71, '22:10': 70, '22:15': 69, '22:20': 68, '22:25': 67, '22:30': 66, '22:35': 65, '22:40': 64 },
                '41-45': { '19:55': 100, '20:00': 99, '20:05': 98, '20:10': 97, '20:15': 96, '20:20': 95, '20:25': 94, '20:30': 93, '20:35': 92, '20:40': 91, '20:45': 90, '20:50': 89, '20:55': 88, '21:00': 87, '21:05': 86, '21:10': 85, '21:15': 84, '21:20': 83, '21:25': 82, '21:30': 81, '21:35': 80, '21:40': 79, '21:45': 78, '21:50': 77, '21:55': 76, '22:00': 75, '22:05': 74, '22:10': 73, '22:15': 72, '22:20': 71, '22:25': 70, '22:30': 69, '22:35': 68, '22:40': 67 },
                '46-50': { '20:15': 100, '20:20': 99, '20:25': 98, '20:30': 97, '20:35': 96, '20:40': 95, '20:45': 94, '20:50': 93, '20:55': 92, '21:00': 91, '21:05': 90, '21:10': 89, '21:15': 88, '21:20': 87, '21:25': 86, '21:30': 85, '21:35': 84, '21:40': 83, '21:45': 82, '21:50': 81, '21:55': 80, '22:00': 79, '22:05': 78, '22:10': 77, '22:15': 76, '22:20': 75, '22:25': 74, '22:30': 73, '22:35': 72, '22:40': 71 },
                '51+': { '20:40': 100, '20:45': 99, '20:50': 98, '20:55': 97, '21:00': 96, '21:05': 95, '21:10': 94, '21:15': 93, '21:20': 92, '21:25': 91, '21:30': 90, '21:35': 89, '21:40': 88, '21:45': 87, '21:50': 86, '21:55': 85, '22:00': 84, '22:05': 83, '22:10': 82, '22:15': 81, '22:20': 80, '22:25': 79, '22:30': 78, '22:35': 77, '22:40': 76 }
            },
            female: {
                '17-20': { '21:40': 100, '21:45': 99, '21:50': 98, '21:55': 97, '22:00': 96, '22:05': 95, '22:10': 95, '22:15': 94, '22:20': 93, '22:25': 92, '22:30': 91, '22:35': 90, '22:40': 89, '22:45': 88, '22:50': 87, '22:55': 86, '23:00': 85, '23:05': 85, '23:10': 84, '23:15': 83, '23:20': 82, '23:25': 81, '23:30': 80, '23:35': 79, '23:40': 78, '23:45': 77, '23:50': 76, '23:55': 75, '24:00': 75, '24:05': 74, '24:10': 73, '24:15': 72, '24:20': 71, '24:25': 70, '24:30': 69, '24:35': 68, '24:40': 67, '24:45': 66, '24:50': 65, '24:55': 64, '25:00': 63, '25:05': 62, '25:10': 61, '25:15': 60, '25:20': 59, '25:25': 58, '25:30': 57, '25:35': 56, '25:40': 55 },
                '21-25': { '21:55': 100, '22:00': 99, '22:05': 98, '22:10': 97, '22:15': 96, '22:20': 95, '22:25': 94, '22:30': 93, '22:35': 92, '22:40': 91, '22:45': 90, '22:50': 89, '22:55': 88, '23:00': 87, '23:05': 86, '23:10': 85, '23:15': 84, '23:20': 83, '23:25': 82, '23:30': 81, '23:35': 80, '23:40': 79, '23:45': 78, '23:50': 77, '23:55': 76, '24:00': 75, '24:05': 74, '24:10': 73, '24:15': 72, '24:20': 71, '24:25': 70, '24:30': 69, '24:35': 68, '24:40': 67, '24:45': 66, '24:50': 65, '24:55': 64, '25:00': 63, '25:05': 62, '25:10': 61, '25:15': 60, '25:20': 59, '25:25': 58, '25:30': 57, '25:35': 56, '25:40': 55 },
                '26-30': { '22:10': 100, '22:15': 99, '22:20': 98, '22:25': 97, '22:30': 96, '22:35': 95, '22:40': 94, '22:45': 93, '22:50': 92, '22:55': 91, '23:00': 90, '23:05': 89, '23:10': 88, '23:15': 87, '23:20': 86, '23:25': 85, '23:30': 84, '23:35': 83, '23:40': 82, '23:45': 81, '23:50': 80, '23:55': 79, '24:00': 78, '24:05': 77, '24:10': 76, '24:15': 75, '24:20': 74, '24:25': 73, '24:30': 72, '24:35': 71, '24:40': 70, '24:45': 69, '24:50': 68, '24:55': 67, '25:00': 66, '25:05': 65, '25:10': 64, '25:15': 63, '25:20': 62, '25:25': 61, '25:30': 60, '25:35': 59, '25:40': 58 },
                '31-35': { '22:25': 100, '22:30': 99, '22:35': 98, '22:40': 97, '22:45': 96, '22:50': 95, '22:55': 94, '23:00': 93, '23:05': 92, '23:10': 91, '23:15': 90, '23:20': 89, '23:25': 88, '23:30': 87, '23:35': 86, '23:40': 85, '23:45': 84, '23:50': 83, '23:55': 82, '24:00': 81, '24:05': 80, '24:10': 79, '24:15': 78, '24:20': 77, '24:25': 76, '24:30': 75, '24:35': 74, '24:40': 73, '24:45': 72, '24:50': 71, '24:55': 70, '25:00': 69, '25:05': 68, '25:10': 67, '25:15': 66, '25:20': 65, '25:25': 64, '25:30': 63, '25:35': 62, '25:40': 61 },
                '36-40': { '22:40': 100, '22:45': 99, '22:50': 98, '22:55': 97, '23:00': 96, '23:05': 95, '23:10': 94, '23:15': 93, '23:20': 92, '23:25': 91, '23:30': 90, '23:35': 89, '23:40': 88, '23:45': 87, '23:50': 86, '23:55': 85, '24:00': 84, '24:05': 83, '24:10': 82, '24:15': 81, '24:20': 80, '24:25': 79, '24:30': 78, '24:35': 77, '24:40': 76, '24:45': 75, '24:50': 74, '24:55': 73, '25:00': 72, '25:05': 71, '25:10': 70, '25:15': 69, '25:20': 68, '25:25': 67, '25:30': 66, '25:35': 65, '25:40': 64 },
                '41-45': { '22:55': 100, '23:00': 99, '23:05': 98, '23:10': 97, '23:15': 96, '23:20': 95, '23:25': 94, '23:30': 93, '23:35': 92, '23:40': 91, '23:45': 90, '23:50': 89, '23:55': 88, '24:00': 87, '24:05': 86, '24:10': 85, '24:15': 84, '24:20': 83, '24:25': 82, '24:30': 81, '24:35': 80, '24:40': 79, '24:45': 78, '24:50': 77, '24:55': 76, '25:00': 75, '25:05': 74, '25:10': 73, '25:15': 72, '25:20': 71, '25:25': 70, '25:30': 69, '25:35': 68, '25:40': 67 },
                '46-50': { '23:15': 100, '23:20': 99, '23:25': 98, '23:30': 97, '23:35': 96, '23:40': 95, '23:45': 94, '23:50': 93, '23:55': 92, '24:00': 91, '24:05': 90, '24:10': 89, '24:15': 88, '24:20': 87, '24:25': 86, '24:30': 85, '24:35': 84, '24:40': 83, '24:45': 82, '24:50': 81, '24:55': 80, '25:00': 79, '25:05': 78, '25:10': 77, '25:15': 76, '25:20': 75, '25:25': 74, '25:30': 73, '25:35': 72, '25:40': 71 },
                '51+': { '23:40': 100, '23:45': 99, '23:50': 98, '23:55': 97, '24:00': 96, '24:05': 95, '24:10': 94, '24:15': 93, '24:20': 92, '24:25': 91, '24:30': 90, '24:35': 89, '24:40': 88, '24:45': 87, '24:50': 86, '24:55': 85, '25:00': 84, '25:05': 83, '25:10': 82, '25:15': 81, '25:20': 80, '25:25': 79, '25:30': 78, '25:35': 77, '25:40': 76 }
            }
        };

        // Switch between PFT and CFT
        function switchTest(testType) {
            currentTest = testType;
            
            // Update active tab
            document.querySelectorAll('.test-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Show/hide event sections
            document.getElementById('pft-events').classList.toggle('hidden', testType !== 'pft');
            document.getElementById('cft-events').classList.toggle('hidden', testType !== 'cft');
            
            // Update results display
            updateResultsDisplay();
        }

        // Main calculate function that routes to PFT or CFT
        function calculateScore() {
            if (currentTest === 'pft') {
                calculatePFT();
            } else {
                calculateCFT();
            }
        }

        // Update results display based on current test
        function updateResultsDisplay() {
            const testName = currentTest.toUpperCase();
            document.getElementById('results-display').innerHTML = `
                <div class="results-card">
                    <h3>ðŸ“Š ${testName} Results</h3>
                    <p>Enter your ${testName} performance data and click "Calculate Score" to see your results.</p>
                </div>
                <div class="standards-table">
                    <h3 style="padding: 15px; margin: 0; background: #8B0000; color: #FFD700;">${testName} Performance Standards</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Classification</th>
                                <th>Score Range</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Body Comp Incentive</strong></td>
                                <td>250-300</td>
                            </tr>
                            <tr>
                                <td><strong>1st Class</strong></td>
                                <td>235-249</td>
                            </tr>
                            <tr>
                                <td><strong>2nd Class</strong></td>
                                <td>200-234</td>
                            </tr>
                            <tr>
                                <td><strong>3rd Class</strong></td>
                                <td>150-199</td>
                            </tr>
                            <tr>
                                <td><strong>Failure</strong></td>
                                <td>Below 150 or failure to meet minimum in any event</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;
        }

        // PFT calculation function with official scoring
        function calculatePFT() {
            try {
                // Get form values
                const gender = document.getElementById('gender').value;
                const ageGroup = document.getElementById('age').value;
                const upperBodyType = document.querySelector('input[name="upper-body"]:checked').value;
                const upperBodyReps = parseInt(document.getElementById('upper-body-reps').value) || 0;
                const plankMinutes = parseInt(document.getElementById('plank-minutes').value) || 0;
                const plankSeconds = parseInt(document.getElementById('plank-seconds').value) || 0;
                const cardioMinutes = parseInt(document.getElementById('cardio-minutes').value) || 0;
                const cardioSeconds = parseInt(document.getElementById('cardio-seconds').value) || 0;
                const cardioType = document.querySelector('input[name="cardio-type"]:checked').value;
                const isAltitude = document.getElementById('pft-altitude-test').checked;

                // Basic validation
                if (upperBodyReps <= 0 || plankMinutes < 0 || cardioMinutes <= 0) {
                    throw new Error('Please enter valid performance data for all events.');
                }

                // Calculate scores using official tables
                let upperBodyScore = calculateUpperBodyScore(gender, ageGroup, upperBodyType, upperBodyReps);
                let plankScore = calculatePlankScore(plankMinutes, plankSeconds);
                let cardioScore = calculateOfficialCardioScore(gender, ageGroup, cardioType, cardioMinutes, cardioSeconds, isAltitude);

                // Total score
                const totalScore = upperBodyScore + plankScore + cardioScore;
                
                // Classification
                const classification = getClassification(totalScore);

                // Display results
                displayPFTResults(upperBodyType, upperBodyReps, upperBodyScore, 
                             plankMinutes, plankSeconds, plankScore,
                             cardioType, cardioMinutes, cardioSeconds, cardioScore,
                             totalScore, classification, isAltitude);

            } catch (error) {
                document.getElementById('results-display').innerHTML = 
                    `<div class="error"><strong>Error:</strong> ${error.message}</div>`;
            }
        }

        // Official cardio scoring using MCO tables
        function calculateOfficialCardioScore(gender, ageGroup, cardioType, minutes, seconds, isAltitude) {
            const timeString = formatTimeForLookup(minutes, seconds);

            if (cardioType === 'run') {
                // Use altitude or sea-level table based on selection
                const scoreTable = isAltitude ? runAltitudeScores : runSeaLevelScores;
                if (scoreTable[gender] && scoreTable[gender][ageGroup]) {
                    return lookupScoreFromTable(scoreTable[gender][ageGroup], timeString);
                } else {
                    // Fall back to age group 17-20 if specific age group not available
                    return lookupScoreFromTable(scoreTable[gender]['17-20'], timeString);
                }
            } else { // row
                const scoreTable = isAltitude ? rowAltitudeScores : rowSeaLevelScores;
                if (scoreTable[gender] && scoreTable[gender][ageGroup]) {
                    return lookupScoreFromTable(scoreTable[gender][ageGroup], timeString);
                } else {
                    // Fall back to age group 17-20 if specific age group not available
                    return lookupScoreFromTable(scoreTable[gender]['17-20'], timeString);
                }
            }
        }

        // Helper function to format time for table lookup
        function formatTimeForLookup(minutes, seconds) {
            return minutes + ':' + (seconds < 10 ? '0' + seconds : seconds);
        }

        // Helper function to lookup score from official table
        function lookupScoreFromTable(scoreTable, timeString) {
            // Direct lookup
            if (scoreTable[timeString]) {
                return scoreTable[timeString];
            }
            
            // Find closest time and interpolate
            const times = Object.keys(scoreTable).sort((a, b) => {
                const [aMin, aSec] = a.split(':').map(Number);
                const [bMin, bSec] = b.split(':').map(Number);
                return (aMin * 60 + aSec) - (bMin * 60 + bSec);
            });
            
            const [targetMin, targetSec] = timeString.split(':').map(Number);
            const targetTotalSec = targetMin * 60 + targetSec;
            
            // Find bounding times
            let lowerTime = null, upperTime = null;
            for (let i = 0; i < times.length; i++) {
                const [min, sec] = times[i].split(':').map(Number);
                const totalSec = min * 60 + sec;
                
                if (totalSec <= targetTotalSec) {
                    lowerTime = times[i];
                } else {
                    upperTime = times[i];
                    break;
                }
            }
            
            // Return appropriate score based on bounds
            if (lowerTime && !upperTime) {
                // Target is slower than slowest time in table
                return Math.max(0, scoreTable[lowerTime] - 10); // Penalty for going slower
            } else if (!lowerTime && upperTime) {
                // Target is faster than fastest time in table
                return scoreTable[upperTime];
            } else if (lowerTime && upperTime) {
                // Interpolate between bounds
                return scoreTable[lowerTime]; // Use lower bound score for safety
            } else {
                return 0; // Fallback
            }
        }

        // Simplified run scoring fallback
        function calculateSimplifiedRunScore(gender, ageGroup, minutes, seconds) {
            const totalMinutes = minutes + (seconds / 60);
            
            if (gender === 'male') {
                if (totalMinutes <= 18.5) return 100;
                if (totalMinutes <= 21) return 85;
                if (totalMinutes <= 24) return 70;
                if (totalMinutes <= 27) return 55;
                if (totalMinutes <= 33) return 40;
                return 0;
            } else {
                if (totalMinutes <= 21.5) return 100;
                if (totalMinutes <= 24) return 85;
                if (totalMinutes <= 27) return 70;
                if (totalMinutes <= 30) return 55;
                if (totalMinutes <= 36) return 40;
                return 0;
            }
        }

        // CFT calculation function
        function calculateCFT() {
            try {
                // Get form values
                const gender = document.getElementById('gender').value;
                const ageGroup = document.getElementById('age').value;
                const isAltitude = document.getElementById('altitude-test').checked;
                
                const mtcMinutes = parseInt(document.getElementById('mtc-minutes').value) || 0;
                const mtcSeconds = parseInt(document.getElementById('mtc-seconds').value) || 0;
                const ammoLifts = parseInt(document.getElementById('ammo-lifts').value) || 0;
                const manufMinutes = parseInt(document.getElementById('manuf-minutes').value) || 0;
                const manufSeconds = parseInt(document.getElementById('manuf-seconds').value) || 0;

                // Basic validation
                if (mtcMinutes <= 0 || ammoLifts <= 0 || manufMinutes <= 0) {
                    throw new Error('Please enter valid performance data for all CFT events.');
                }

                // Calculate scores
                let mtcScore = calculateMTCScore(gender, ageGroup, mtcMinutes, mtcSeconds);
                let alScore = calculateALScore(gender, ageGroup, ammoLifts);
                let manufScore = calculateMANUFScore(gender, ageGroup, manufMinutes, manufSeconds);

                // Total score
                const totalScore = mtcScore + alScore + manufScore;
                
                // Classification
                const classification = getClassification(totalScore);

                // Display results
                displayCFTResults(mtcMinutes, mtcSeconds, mtcScore,
                                ammoLifts, alScore,
                                manufMinutes, manufSeconds, manufScore,
                                totalScore, classification, isAltitude);

            } catch (error) {
                document.getElementById('results-display').innerHTML = 
                    `<div class="error"><strong>Error:</strong> ${error.message}</div>`;
            }
        }

        // CFT Scoring Functions
        function calculateMTCScore(gender, ageGroup, minutes, seconds) {
            const totalSeconds = minutes * 60 + seconds;
            
            if (gender === 'male') {
                if (totalSeconds <= 160) return 100;  // 2:40
                if (totalSeconds <= 180) return 85;   // 3:00
                if (totalSeconds <= 200) return 70;   // 3:20
                if (totalSeconds <= 225) return 40;   // 3:45
                return 0;
            } else {
                if (totalSeconds <= 199) return 100;  // 3:19
                if (totalSeconds <= 220) return 85;   // 3:40
                if (totalSeconds <= 240) return 70;   // 4:00
                if (totalSeconds <= 276) return 40;   // 4:36
                return 0;
            }
        }

        function calculateALScore(gender, ageGroup, reps) {
            if (gender === 'male') {
                if (reps >= 120) return 100;
                if (reps >= 100) return 85;
                if (reps >= 80) return 70;
                if (reps >= 62) return 40;
                return 0;
            } else {
                if (reps >= 66) return 100;
                if (reps >= 50) return 85;
                if (reps >= 40) return 70;
                if (reps >= 30) return 40;
                return 0;
            }
        }

        function calculateMANUFScore(gender, ageGroup, minutes, seconds) {
            const totalSeconds = minutes * 60 + seconds;
            
            if (gender === 'male') {
                if (totalSeconds <= 127) return 100;  // 2:07
                if (totalSeconds <= 150) return 85;   // 2:30
                if (totalSeconds <= 167) return 70;   // 2:47
                if (totalSeconds <= 197) return 40;   // 3:17
                return 0;
            } else {
                if (totalSeconds <= 175) return 100;  // 2:55
                if (totalSeconds <= 195) return 85;   // 3:15
                if (totalSeconds <= 205) return 70;   // 3:25
                if (totalSeconds <= 293) return 40;   // 4:53
                return 0;
            }
        }

        // Complete Age-Specific Pull-up Scoring Tables (MCO 6100.13A Table 2-1)
        const pullupScores = {
            male: {
                '17-20': {23:100,22:99,21:98,20:97,19:95,18:93,17:90,16:87,15:84,14:81,13:77,12:73,11:70,10:66,9:62,8:58,7:54,6:50,5:46,4:42,3:38,2:0,1:0,0:0},
                '21-25': {23:100,22:99,21:98,20:97,19:95,18:93,17:90,16:87,15:84,14:81,13:77,12:73,11:70,10:66,9:62,8:58,7:54,6:50,5:46,4:42,3:38,2:0,1:0,0:0},
                '26-30': {23:100,22:99,21:98,20:97,19:96,18:94,17:92,16:89,15:86,14:83,13:80,12:76,11:72,10:68,9:64,8:60,7:56,6:52,5:48,4:44,3:40,2:0,1:0,0:0},
                '31-35': {23:100,22:99,21:98,20:97,19:96,18:95,17:93,16:91,15:88,14:85,13:82,12:78,11:74,10:70,9:66,8:62,7:58,6:54,5:50,4:45,3:40,2:0,1:0,0:0},
                '36-40': {23:100,22:100,21:99,20:98,19:97,18:96,17:94,16:92,15:90,14:87,13:84,12:80,11:76,10:72,9:68,8:64,7:60,6:55,5:50,4:45,3:40,2:0,1:0,0:0},
                '41-45': {23:100,22:100,21:100,20:99,19:98,18:97,17:95,16:93,15:91,14:88,13:85,12:82,11:78,10:74,9:70,8:65,7:60,6:55,5:50,4:45,3:40,2:0,1:0,0:0},
                '46-50': {23:100,22:100,21:100,20:100,19:99,18:98,17:96,16:94,15:92,14:89,13:86,12:83,11:79,10:75,9:70,8:65,7:60,6:55,5:50,4:45,3:40,2:0,1:0,0:0},
                '51+': {23:100,22:100,21:100,20:100,19:100,18:99,17:97,16:95,15:93,14:90,13:87,12:84,11:80,10:76,9:71,8:66,7:61,6:56,5:51,4:45,3:40,2:0,1:0,0:0}
            },
            female: {
                '17-20': {12:100,11:98,10:96,9:93,8:90,7:86,6:82,5:77,4:72,3:66,2:60,1:40,0:0},
                '21-25': {12:100,11:98,10:96,9:93,8:90,7:86,6:82,5:77,4:72,3:66,2:60,1:40,0:0},
                '26-30': {12:100,11:99,10:97,9:94,8:91,7:88,6:84,5:79,4:74,3:68,2:62,1:40,0:0},
                '31-35': {12:100,11:99,10:98,9:95,8:92,7:89,6:85,5:80,4:75,3:70,2:64,1:40,0:0},
                '36-40': {12:100,11:100,10:99,9:96,8:93,7:90,6:86,5:82,4:77,3:72,2:66,1:40,0:0},
                '41-45': {12:100,11:100,10:100,9:97,8:94,7:91,6:87,5:83,4:78,3:73,2:67,1:40,0:0},
                '46-50': {12:100,11:100,10:100,9:98,8:95,7:92,6:88,5:84,4:79,3:74,2:68,1:40,0:0},
                '51+': {12:100,11:100,10:100,9:99,8:96,7:93,6:89,5:85,4:80,3:75,2:69,1:40,0:0}
            }
        };

        // Complete Age-Specific Push-up Scoring Tables (MCO 6100.13A Table 2-2)
        const pushupScores = {
            male: {
                '17-20': {82:100,81:99,80:98,79:97,78:96,77:95,76:94,75:93,74:92,73:91,72:90,71:89,70:88,69:87,68:86,67:85,66:84,65:83,64:82,63:81,62:80,61:79,60:78,59:77,58:76,57:75,56:74,55:73,54:72,53:71,52:70,51:69,50:68,49:67,48:66,47:65,46:64,45:63,44:62,43:61,42:60,41:59,40:58,39:57,38:56,37:55,36:54,35:53,34:52,33:51,32:50,31:49,30:48,29:47,28:46,27:45,26:44,25:43,24:42,23:41,22:40,21:0,20:0},
                '21-25': {87:100,86:99,85:98,84:97,83:96,82:95,81:94,80:93,79:92,78:91,77:90,76:89,75:88,74:87,73:86,72:85,71:84,70:83,69:82,68:81,67:80,66:79,65:78,64:77,63:76,62:75,61:74,60:73,59:72,58:71,57:70,56:69,55:68,54:67,53:66,52:65,51:64,50:63,49:62,48:61,47:60,46:59,45:58,44:57,43:56,42:55,41:54,40:53,39:52,38:51,37:50,36:49,35:48,34:47,33:46,32:45,31:44,30:43,29:42,28:41,27:40,26:0,25:0},
                '26-30': {84:100,83:99,82:98,81:97,80:96,79:95,78:94,77:93,76:92,75:91,74:90,73:89,72:88,71:87,70:86,69:85,68:84,67:83,66:82,65:81,64:80,63:79,62:78,61:77,60:76,59:75,58:74,57:73,56:72,55:71,54:70,53:69,52:68,51:67,50:66,49:65,48:64,47:63,46:62,45:61,44:60,43:59,42:58,41:57,40:56,39:55,38:54,37:53,36:52,35:51,34:50,33:49,32:48,31:47,30:46,29:45,28:44,27:43,26:42,25:41,24:40,23:0,22:0},
                '31-35': {80:100,79:99,78:98,77:97,76:96,75:95,74:94,73:93,72:92,71:91,70:90,69:89,68:88,67:87,66:86,65:85,64:84,63:83,62:82,61:81,60:80,59:79,58:78,57:77,56:76,55:75,54:74,53:73,52:72,51:71,50:70,49:69,48:68,47:67,46:66,45:65,44:64,43:63,42:62,41:61,40:60,39:59,38:58,37:57,36:56,35:55,34:54,33:53,32:52,31:51,30:50,29:49,28:48,27:47,26:46,25:45,24:44,23:43,22:42,21:41,20:40,19:0,18:0},
                '36-40': {76:100,75:99,74:98,73:97,72:96,71:95,70:94,69:93,68:92,67:91,66:90,65:89,64:88,63:87,62:86,61:85,60:84,59:83,58:82,57:81,56:80,55:79,54:78,53:77,52:76,51:75,50:74,49:73,48:72,47:71,46:70,45:69,44:68,43:67,42:66,41:65,40:64,39:63,38:62,37:61,36:60,35:59,34:58,33:57,32:56,31:55,30:54,29:53,28:52,27:51,26:50,25:49,24:48,23:47,22:46,21:45,20:44,19:43,18:42,17:41,16:40,15:0,14:0},
                '41-45': {72:100,71:99,70:98,69:97,68:96,67:95,66:94,65:93,64:92,63:91,62:90,61:89,60:88,59:87,58:86,57:85,56:84,55:83,54:82,53:81,52:80,51:79,50:78,49:77,48:76,47:75,46:74,45:73,44:72,43:71,42:70,41:69,40:68,39:67,38:66,37:65,36:64,35:63,34:62,33:61,32:60,31:59,30:58,29:57,28:56,27:55,26:54,25:53,24:52,23:51,22:50,21:49,20:48,19:47,18:46,17:45,16:44,15:43,14:42,13:41,12:40,11:0,10:0},
                '46-50': {68:100,67:99,66:98,65:97,64:96,63:95,62:94,61:93,60:92,59:91,58:90,57:89,56:88,55:87,54:86,53:85,52:84,51:83,50:82,49:81,48:80,47:79,46:78,45:77,44:76,43:75,42:74,41:73,40:72,39:71,38:70,37:69,36:68,35:67,34:66,33:65,32:64,31:63,30:62,29:61,28:60,27:59,26:58,25:57,24:56,23:55,22:54,21:53,20:52,19:51,18:50,17:49,16:48,15:47,14:46,13:45,12:44,11:43,10:42,9:41,8:40,7:0,6:0},
                '51+': {64:100,63:99,62:98,61:97,60:96,59:95,58:94,57:93,56:92,55:91,54:90,53:89,52:88,51:87,50:86,49:85,48:84,47:83,46:82,45:81,44:80,43:79,42:78,41:77,40:76,39:75,38:74,37:73,36:72,35:71,34:70,33:69,32:68,31:67,30:66,29:65,28:64,27:63,26:62,25:61,24:60,23:59,22:58,21:57,20:56,19:55,18:54,17:53,16:52,15:51,14:50,13:49,12:48,11:47,10:46,9:45,8:44,7:43,6:42,5:41,4:40,3:0,2:0}
            },
            female: {
                '17-20': {50:100,49:99,48:98,47:97,46:96,45:95,44:94,43:93,42:92,41:91,40:90,39:89,38:88,37:87,36:86,35:85,34:84,33:83,32:82,31:81,30:80,29:79,28:78,27:77,26:76,25:75,24:74,23:73,22:72,21:71,20:70,19:69,18:68,17:67,16:66,15:65,14:64,13:63,12:62,11:61,10:60,9:58,8:56,7:54,6:52,5:50,4:48,3:46,2:44,1:42,0:40},
                '21-25': {50:100,49:99,48:98,47:97,46:96,45:95,44:94,43:93,42:92,41:91,40:90,39:89,38:88,37:87,36:86,35:85,34:84,33:83,32:82,31:81,30:80,29:79,28:78,27:77,26:76,25:75,24:74,23:73,22:72,21:71,20:70,19:69,18:68,17:67,16:66,15:65,14:64,13:63,12:62,11:61,10:60,9:58,8:56,7:54,6:52,5:50,4:48,3:46,2:44,1:42,0:40},
                '26-30': {50:100,49:99,48:98,47:97,46:96,45:95,44:94,43:93,42:92,41:91,40:90,39:89,38:88,37:87,36:86,35:85,34:84,33:83,32:82,31:81,30:80,29:79,28:78,27:77,26:76,25:75,24:74,23:73,22:72,21:71,20:70,19:69,18:68,17:67,16:66,15:65,14:64,13:63,12:62,11:61,10:60,9:58,8:56,7:54,6:52,5:50,4:48,3:46,2:44,1:42,0:40},
                '31-35': {48:100,47:99,46:98,45:97,44:96,43:95,42:94,41:93,40:92,39:91,38:90,37:89,36:88,35:87,34:86,33:85,32:84,31:83,30:82,29:81,28:80,27:79,26:78,25:77,24:76,23:75,22:74,21:73,20:72,19:71,18:70,17:68,16:66,15:64,14:62,13:60,12:58,11:56,10:54,9:52,8:50,7:48,6:46,5:44,4:42,3:40,2:0,1:0,0:0},
                '36-40': {45:100,44:99,43:98,42:97,41:96,40:95,39:94,38:93,37:92,36:91,35:90,34:89,33:88,32:87,31:86,30:85,29:84,28:83,27:82,26:81,25:80,24:79,23:78,22:77,21:76,20:75,19:74,18:73,17:72,16:71,15:70,14:68,13:66,12:64,11:62,10:60,9:58,8:56,7:54,6:52,5:50,4:48,3:46,2:44,1:42,0:40},
                '41-45': {42:100,41:99,40:98,39:97,38:96,37:95,36:94,35:93,34:92,33:91,32:90,31:89,30:88,29:87,28:86,27:85,26:84,25:83,24:82,23:81,22:80,21:79,20:78,19:77,18:76,17:75,16:74,15:73,14:72,13:71,12:70,11:68,10:66,9:64,8:62,7:60,6:58,5:56,4:54,3:52,2:50,1:48,0:46},
                '46-50': {40:100,39:99,38:98,37:97,36:96,35:95,34:94,33:93,32:92,31:91,30:90,29:89,28:88,27:87,26:86,25:85,24:84,23:83,22:82,21:81,20:80,19:79,18:78,17:77,16:76,15:75,14:74,13:73,12:72,11:71,10:70,9:68,8:66,7:64,6:62,5:60,4:58,3:56,2:54,1:52,0:50},
                '51+': {38:100,37:99,36:98,35:97,34:96,33:95,32:94,31:93,30:92,29:91,28:90,27:89,26:88,25:87,24:86,23:85,22:84,21:83,20:82,19:81,18:80,17:79,16:78,15:77,14:76,13:75,12:74,11:73,10:72,9:71,8:70,7:68,6:66,5:64,4:62,3:60,2:58,1:56,0:54}
            }
        };

        // Calculate upper body score using official age-specific tables
        function calculateUpperBodyScore(gender, ageGroup, type, reps) {
            const table = type === 'pullups' ? pullupScores : pushupScores;

            if (table[gender] && table[gender][ageGroup]) {
                const ageTable = table[gender][ageGroup];
                // Direct lookup
                if (ageTable[reps] !== undefined) {
                    return ageTable[reps];
                }
                // Find nearest lower value for interpolation
                const sortedReps = Object.keys(ageTable).map(Number).sort((a, b) => b - a);
                for (const rep of sortedReps) {
                    if (reps >= rep) {
                        return ageTable[rep];
                    }
                }
                return 0;
            }
            return 0;
        }

        // Get minimum reps needed for a target score
        function getMinRepsForScore(gender, ageGroup, type, targetScore) {
            const table = type === 'pullups' ? pullupScores : pushupScores;

            if (table[gender] && table[gender][ageGroup]) {
                const ageTable = table[gender][ageGroup];
                const sortedReps = Object.keys(ageTable).map(Number).sort((a, b) => a - b);

                for (const rep of sortedReps) {
                    if (ageTable[rep] >= targetScore) {
                        return rep;
                    }
                }
            }
            return 'N/A';
        }

        // Official Plank Scoring Table (Table 2-4) - Gender and Age Neutral
        const plankScores = {
            '3:45': 100, '3:43': 99, '3:40': 98, '3:38': 97, '3:35': 96, '3:33': 95, '3:30': 94, '3:27': 93, '3:25': 92, '3:22': 91,
            '3:20': 90, '3:17': 89, '3:14': 88, '3:12': 87, '3:09': 86, '3:07': 85, '3:04': 84, '3:02': 83, '2:59': 82, '2:56': 81,
            '2:54': 80, '2:51': 79, '2:49': 78, '2:46': 77, '2:43': 76, '2:41': 75, '2:38': 74, '2:36': 73, '2:33': 72, '2:31': 71,
            '2:28': 70, '2:25': 69, '2:23': 68, '2:20': 67, '2:18': 66, '2:15': 65, '2:12': 64, '2:10': 63, '2:07': 62, '2:05': 61,
            '2:02': 60, '2:00': 59, '1:57': 58, '1:54': 57, '1:52': 56, '1:49': 55, '1:47': 54, '1:44': 53, '1:41': 52, '1:39': 51,
            '1:36': 50, '1:34': 49, '1:31': 48, '1:29': 47, '1:26': 46, '1:23': 45, '1:21': 44, '1:18': 43, '1:16': 42, '1:13': 41,
            '1:10': 40
        };

        function calculatePlankScore(minutes, seconds) {
            const timeString = formatTimeForLookup(minutes, seconds);
            
            // Direct lookup from official table
            if (plankScores[timeString]) {
                return plankScores[timeString];
            }
            
            // Find closest time and interpolate
            const times = Object.keys(plankScores).sort((a, b) => {
                const [aMin, aSec] = a.split(':').map(Number);
                const [bMin, bSec] = b.split(':').map(Number);
                return (bMin * 60 + bSec) - (aMin * 60 + aSec); // Sort descending by total seconds
            });
            
            const [targetMin, targetSec] = timeString.split(':').map(Number);
            const targetTotalSec = targetMin * 60 + targetSec;
            
            // Find bounding times
            let lowerTime = null, upperTime = null;
            for (let i = 0; i < times.length; i++) {
                const [min, sec] = times[i].split(':').map(Number);
                const totalSec = min * 60 + sec;
                
                if (totalSec >= targetTotalSec) {
                    lowerTime = times[i];
                } else {
                    upperTime = times[i];
                    break;
                }
            }
            
            // Return appropriate score based on bounds
            if (lowerTime && !upperTime) {
                // Target is slower than slowest time in table (below 1:10)
                return Math.max(0, plankScores[lowerTime] - 10); // Penalty for going slower
            } else if (!lowerTime && upperTime) {
                // Target is faster than fastest time in table (above 3:45)
                return plankScores[upperTime];
            } else if (lowerTime && upperTime) {
                // Use lower bound score for safety
                return plankScores[lowerTime];
            } else {
                return 0; // Fallback
            }
        }

        function getClassification(score) {
            if (score >= 250) return { class: 'body-comp-incentive', name: 'Body Comp Incentive' };
            if (score >= 235) return { class: 'first-class', name: '1st Class' };
            if (score >= 200) return { class: 'second-class', name: '2nd Class' };
            if (score >= 150) return { class: 'third-class', name: '3rd Class' };
            return { class: 'fail', name: 'Failure' };
        }

        function displayPFTResults(upperBodyType, upperBodyReps, upperBodyScore,
                              plankMin, plankSec, plankScore,
                              cardioType, cardioMin, cardioSec, cardioScore,
                              totalScore, classification, isAltitude) {

            const plankDisplay = plankMin + ":" + (plankSec < 10 ? "0" + plankSec : plankSec);
            const cardioDisplay = cardioMin + ":" + (cardioSec < 10 ? "0" + cardioSec : cardioSec);
            const cardioLabel = cardioType === 'run' ? '3-Mile Run' : '5,000m Row';

            let resultsHTML = '';

            if (isAltitude) {
                resultsHTML += `<div class="error" style="background: #fff3cd; color: #856404; border-left-color: #ffc107;"><strong>Altitude Test:</strong> This PFT was conducted at altitude (4,500+ feet MSL) using official compensation tables.</div>`;
            }

            resultsHTML += `
                <div class="total-score">
                    <h2>${totalScore}</h2>
                    <div class="classification ${classification.class}">${classification.name}</div>
                </div>

                ${createScoreGauges([
                    { label: upperBodyType.charAt(0).toUpperCase() + upperBodyType.slice(1), score: upperBodyScore },
                    { label: 'Plank', score: plankScore },
                    { label: cardioLabel, score: cardioScore }
                ])}

                <div class="results-card">
                    <h3>ðŸ“Š PFT Event Scores</h3>
                    <div class="score-item">
                        <span>${upperBodyType.charAt(0).toUpperCase() + upperBodyType.slice(1)}: ${upperBodyReps} reps</span>
                        <span class="score-value">${upperBodyScore} pts</span>
                    </div>
                    <div class="score-item">
                        <span>Plank: ${plankDisplay}</span>
                        <span class="score-value">${plankScore} pts</span>
                    </div>
                    <div class="score-item">
                        <span>${cardioLabel}: ${cardioDisplay}</span>
                        <span class="score-value">${cardioScore} pts</span>
                    </div>
                </div>

                ${createImprovementFeedback(totalScore, classification)}

                <div class="result-actions">
                    <button class="action-btn" onclick="printResults()">ðŸ–¨ï¸ Print</button>
                    <button class="action-btn" onclick="shareResults(${totalScore}, '${classification.name}', 'PFT')">ðŸ“¤ Share</button>
                </div>
            `;

            document.getElementById('results-display').innerHTML = resultsHTML;

            // Save to history
            saveToHistory('PFT', totalScore, classification.name);
            renderHistory();
        }

        function displayCFTResults(mtcMin, mtcSec, mtcScore,
                                 ammoLifts, alScore,
                                 manufMin, manufSec, manufScore,
                                 totalScore, classification, isAltitude) {

            const mtcDisplay = mtcMin + ":" + (mtcSec < 10 ? "0" + mtcSec : mtcSec);
            const manufDisplay = manufMin + ":" + (manufSec < 10 ? "0" + manufSec : manufSec);

            let resultsHTML = '';

            if (isAltitude) {
                resultsHTML += `<div class="error" style="background: #fff3cd; color: #856404; border-left-color: #ffc107;"><strong>Altitude Test:</strong> This CFT was conducted at altitude (4,500+ feet MSL).</div>`;
            }

            resultsHTML += `
                <div class="total-score">
                    <h2>${totalScore}</h2>
                    <div class="classification ${classification.class}">${classification.name}</div>
                </div>

                ${createScoreGauges([
                    { label: 'MTC', score: mtcScore },
                    { label: 'Ammo Lift', score: alScore },
                    { label: 'MANUF', score: manufScore }
                ])}

                <div class="results-card">
                    <h3>ðŸ“Š CFT Event Scores</h3>
                    <div class="score-item">
                        <span>Movement to Contact: ${mtcDisplay}</span>
                        <span class="score-value">${mtcScore} pts</span>
                    </div>
                    <div class="score-item">
                        <span>Ammunition Lift: ${ammoLifts} reps</span>
                        <span class="score-value">${alScore} pts</span>
                    </div>
                    <div class="score-item">
                        <span>Maneuver Under Fire: ${manufDisplay}</span>
                        <span class="score-value">${manufScore} pts</span>
                    </div>
                </div>

                ${createImprovementFeedback(totalScore, classification)}

                <div class="result-actions">
                    <button class="action-btn" onclick="printResults()">ðŸ–¨ï¸ Print</button>
                    <button class="action-btn" onclick="shareResults(${totalScore}, '${classification.name}', 'CFT')">ðŸ“¤ Share</button>
                </div>
            `;

            document.getElementById('results-display').innerHTML = resultsHTML;

            // Save to history
            saveToHistory('CFT', totalScore, classification.name);
            renderHistory();
        }

        // ===============================
        // VISUAL SCORE GAUGES
        // ===============================
        function createScoreGauges(events) {
            const gauges = events.map(event => createSingleGauge(event.label, event.score)).join('');
            return `<div class="score-gauge-container">${gauges}</div>`;
        }

        function createSingleGauge(label, score) {
            const radius = 36;
            const circumference = 2 * Math.PI * radius;
            const percentage = Math.min(score / 100, 1);
            const offset = circumference * (1 - percentage);
            const color = getScoreColor(score);

            return `
                <div class="score-gauge">
                    <svg viewBox="0 0 90 90">
                        <circle class="bg" cx="45" cy="45" r="${radius}"></circle>
                        <circle class="progress" cx="45" cy="45" r="${radius}"
                            stroke="${color}"
                            stroke-dasharray="${circumference}"
                            stroke-dashoffset="${offset}">
                        </circle>
                    </svg>
                    <div class="gauge-text">
                        <div class="gauge-value">${score}</div>
                        <div class="gauge-label">${label}</div>
                    </div>
                </div>
            `;
        }

        function getScoreColor(score) {
            if (score >= 80) return '#28a745';  // Green
            if (score >= 60) return '#ffc107';  // Yellow
            if (score >= 40) return '#fd7e14';  // Orange
            return '#dc3545';  // Red
        }

        // ===============================
        // IMPROVEMENT FEEDBACK
        // ===============================
        function createImprovementFeedback(totalScore, classification) {
            const thresholds = [
                { name: 'Body Comp Incentive', score: 250, class: 'body-comp-incentive' },
                { name: '1st Class', score: 235, class: 'first-class' },
                { name: '2nd Class', score: 200, class: 'second-class' },
                { name: '3rd Class', score: 150, class: 'third-class' }
            ];

            let feedbackItems = [];

            for (const threshold of thresholds) {
                if (totalScore >= threshold.score) {
                    feedbackItems.push(`
                        <div class="improvement-item achieved">
                            <span class="icon">âœ“</span>
                            <span>${threshold.name} achieved!</span>
                        </div>
                    `);
                } else {
                    const pointsNeeded = threshold.score - totalScore;
                    feedbackItems.push(`
                        <div class="improvement-item">
                            <span class="icon">â†’</span>
                            <span><strong>${pointsNeeded} more points</strong> needed for ${threshold.name}</span>
                        </div>
                    `);
                }
            }

            // Add specific tips based on current score
            let tip = '';
            if (totalScore < 150) {
                tip = '<div class="improvement-item"><span class="icon">ðŸ’¡</span><span>Focus on improving your weakest event for the biggest gains.</span></div>';
            } else if (totalScore < 235) {
                const toFirst = 235 - totalScore;
                tip = `<div class="improvement-item"><span class="icon">ðŸ’¡</span><span>Just ${toFirst} points to reach 1st Class - you're close!</span></div>`;
            } else if (totalScore < 250) {
                const toBodyComp = 250 - totalScore;
                tip = `<div class="improvement-item"><span class="icon">ðŸ’¡</span><span>Only ${toBodyComp} more points to earn Body Composition Incentives!</span></div>`;
            } else if (totalScore < 285) {
                tip = '<div class="improvement-item"><span class="icon">ðŸ’¡</span><span>Great score! Push for 285+ for Commanding General recognition.</span></div>';
            } else {
                tip = '<div class="improvement-item achieved"><span class="icon">ðŸ†</span><span>Outstanding performance! You\'re among the top performers.</span></div>';
            }

            return `
                <div class="improvement-feedback">
                    <h4>ðŸ“ˆ Path to Improvement</h4>
                    ${feedbackItems.join('')}
                    ${tip}
                </div>
            `;
        }

        // ===============================
        // INPUT VALIDATION FUNCTIONS
        // ===============================
        function validateUpperBody(input) {
            const type = document.querySelector('input[name="upper-body"]:checked').value;
            const value = parseInt(input.value) || 0;
            const errorEl = document.getElementById('upper-body-error');

            let max = type === 'pullups' ? 30 : 120;
            let isValid = value >= 0 && value <= max;

            input.classList.toggle('invalid', !isValid && input.value !== '');
            input.classList.toggle('valid', isValid && input.value !== '');
            errorEl.style.display = (!isValid && input.value !== '') ? 'block' : 'none';
            errorEl.textContent = `Please enter 0-${max} ${type}`;
        }

        function updateUpperBodyHint() {
            const type = document.querySelector('input[name="upper-body"]:checked').value;
            const hintEl = document.getElementById('upper-body-hint');
            const inputEl = document.getElementById('upper-body-reps');

            if (type === 'pullups') {
                hintEl.textContent = 'Pull-ups: 0-30 typical range';
                inputEl.max = 30;
            } else {
                hintEl.textContent = 'Push-ups: 0-120 typical range';
                inputEl.max = 120;
            }
            validateUpperBody(inputEl);
        }

        function validatePlank() {
            const minEl = document.getElementById('plank-minutes');
            const secEl = document.getElementById('plank-seconds');
            const errorEl = document.getElementById('plank-error');

            const min = parseInt(minEl.value) || 0;
            const sec = parseInt(secEl.value) || 0;
            const totalSec = min * 60 + sec;

            let isValid = totalSec >= 0 && totalSec <= 300 && sec < 60; // Max 5 minutes

            minEl.classList.toggle('invalid', !isValid && (minEl.value !== '' || secEl.value !== ''));
            secEl.classList.toggle('invalid', !isValid && (minEl.value !== '' || secEl.value !== ''));
            errorEl.style.display = (!isValid && (minEl.value !== '' || secEl.value !== '')) ? 'block' : 'none';
        }

        function validateCardio() {
            const minEl = document.getElementById('cardio-minutes');
            const secEl = document.getElementById('cardio-seconds');
            const errorEl = document.getElementById('cardio-error');

            const min = parseInt(minEl.value) || 0;
            const sec = parseInt(secEl.value) || 0;

            let isValid = min >= 0 && min <= 45 && sec >= 0 && sec < 60;

            minEl.classList.toggle('invalid', !isValid && (minEl.value !== '' || secEl.value !== ''));
            secEl.classList.toggle('invalid', !isValid && (minEl.value !== '' || secEl.value !== ''));
            errorEl.style.display = (!isValid && (minEl.value !== '' || secEl.value !== '')) ? 'block' : 'none';
        }

        function updateCardioHint() {
            const type = document.querySelector('input[name="cardio-type"]:checked').value;
            const hintEl = document.getElementById('cardio-hint');

            if (type === 'run') {
                hintEl.textContent = '3-Mile Run: 18:00-33:00 typical range';
            } else {
                hintEl.textContent = '5,000m Row: 18:00-25:00 typical range';
            }
        }

        function validateMTC() {
            const minEl = document.getElementById('mtc-minutes');
            const secEl = document.getElementById('mtc-seconds');
            const errorEl = document.getElementById('mtc-error');

            const min = parseInt(minEl.value) || 0;
            const sec = parseInt(secEl.value) || 0;

            let isValid = min >= 0 && min <= 6 && sec >= 0 && sec < 60;

            minEl.classList.toggle('invalid', !isValid && (minEl.value !== '' || secEl.value !== ''));
            secEl.classList.toggle('invalid', !isValid && (minEl.value !== '' || secEl.value !== ''));
            errorEl.style.display = (!isValid && (minEl.value !== '' || secEl.value !== '')) ? 'block' : 'none';
        }

        function validateAmmoLift(input) {
            const value = parseInt(input.value) || 0;
            const errorEl = document.getElementById('ammo-error');

            let isValid = value >= 0 && value <= 150;

            input.classList.toggle('invalid', !isValid && input.value !== '');
            input.classList.toggle('valid', isValid && input.value !== '');
            errorEl.style.display = (!isValid && input.value !== '') ? 'block' : 'none';
        }

        function validateMANUF() {
            const minEl = document.getElementById('manuf-minutes');
            const secEl = document.getElementById('manuf-seconds');
            const errorEl = document.getElementById('manuf-error');

            const min = parseInt(minEl.value) || 0;
            const sec = parseInt(secEl.value) || 0;

            let isValid = min >= 0 && min <= 6 && sec >= 0 && sec < 60;

            minEl.classList.toggle('invalid', !isValid && (minEl.value !== '' || secEl.value !== ''));
            secEl.classList.toggle('invalid', !isValid && (minEl.value !== '' || secEl.value !== ''));
            errorEl.style.display = (!isValid && (minEl.value !== '' || secEl.value !== '')) ? 'block' : 'none';
        }

        // ===============================
        // LOCAL STORAGE HISTORY
        // ===============================
        const HISTORY_KEY = 'pft_cft_history';
        const MAX_HISTORY = 10;

        function saveToHistory(testType, score, classification) {
            let history = getHistory();

            const entry = {
                id: Date.now(),
                date: new Date().toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                }),
                testType: testType,
                score: score,
                classification: classification
            };

            history.unshift(entry);

            // Keep only last MAX_HISTORY entries
            if (history.length > MAX_HISTORY) {
                history = history.slice(0, MAX_HISTORY);
            }

            localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
        }

        function getHistory() {
            try {
                return JSON.parse(localStorage.getItem(HISTORY_KEY)) || [];
            } catch (e) {
                return [];
            }
        }

        function clearHistory() {
            localStorage.removeItem(HISTORY_KEY);
            renderHistory();
        }

        function renderHistory() {
            const container = document.getElementById('history-container');
            const history = getHistory();

            if (history.length === 0) {
                container.innerHTML = `
                    <div class="history-panel">
                        <h4>ðŸ“œ Score History</h4>
                        <div class="no-history">No scores recorded yet. Calculate a score to start tracking!</div>
                    </div>
                `;
                return;
            }

            const historyItems = history.map(entry => {
                const classKey = entry.classification.toLowerCase().replace(/\s+/g, '-').replace('1st', 'first').replace('2nd', 'second').replace('3rd', 'third').replace('body-comp-incentive', 'body-comp-incentive');
                return `
                    <div class="history-item">
                        <div>
                            <div class="test-type">${entry.testType}</div>
                            <div class="date">${entry.date}</div>
                        </div>
                        <div style="text-align: right;">
                            <div class="score">${entry.score}</div>
                            <span class="classification-badge ${classKey}">${entry.classification}</span>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = `
                <div class="history-panel">
                    <h4>
                        <span>ðŸ“œ Score History</span>
                        <button class="clear-btn" onclick="clearHistory()">Clear</button>
                    </h4>
                    ${historyItems}
                </div>
            `;
        }

        // ===============================
        // DARK MODE
        // ===============================
        function toggleDarkMode() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);

            // Update icon
            document.getElementById('theme-icon').textContent = newTheme === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            document.getElementById('theme-icon').textContent = savedTheme === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';
        }

        // ===============================
        // GOAL CALCULATOR
        // ===============================
        function openGoalCalculator() {
            document.getElementById('goal-modal').classList.add('active');
            calculateGoals();
        }

        function closeGoalCalculator() {
            document.getElementById('goal-modal').classList.remove('active');
        }

        function updateGoalForm() {
            calculateGoals();
        }

        function calculateGoals() {
            const testType = document.getElementById('goal-test-type').value;
            const gender = document.getElementById('goal-gender').value;
            const ageGroup = document.getElementById('goal-age').value;
            const targetScore = parseInt(document.getElementById('goal-classification').value);

            // Calculate per-event target (divide evenly)
            const perEventTarget = Math.ceil(targetScore / 3);

            let resultsHTML = '';

            if (testType === 'pft') {
                resultsHTML = calculatePFTGoals(gender, ageGroup, perEventTarget, targetScore);
            } else {
                resultsHTML = calculateCFTGoals(gender, ageGroup, perEventTarget, targetScore);
            }

            document.getElementById('goal-results').innerHTML = resultsHTML;
        }

        function calculatePFTGoals(gender, ageGroup, perEventTarget, totalTarget) {
            // Get minimum requirements for each event
            const pullupReq = getMinRepsForScore(gender, ageGroup, 'pullups', perEventTarget);
            const pushupReq = getMinRepsForScore(gender, ageGroup, 'pushups', perEventTarget);
            const plankReq = getMinTimeForPlankScore(perEventTarget);
            const runReq = getMinTimeForRunScore(gender, ageGroup, perEventTarget);

            return `
                <div class="goal-result">
                    <h3>ðŸŽ¯ Target: ${totalTarget}+ Points (${perEventTarget}+ per event)</h3>

                    <div class="goal-item">
                        <span class="event-name">Pull-ups</span>
                        <span class="requirement">${pullupReq}+ reps</span>
                    </div>
                    <div class="goal-item">
                        <span class="event-name">Push-ups (alternative)</span>
                        <span class="requirement">${pushupReq}+ reps</span>
                    </div>
                    <div class="goal-item">
                        <span class="event-name">Plank</span>
                        <span class="requirement">${plankReq} or better</span>
                    </div>
                    <div class="goal-item">
                        <span class="event-name">3-Mile Run</span>
                        <span class="requirement">${runReq} or faster</span>
                    </div>

                    <p style="margin-top: 15px; font-size: 0.9em; color: var(--text-secondary);">
                        ðŸ’¡ <strong>Tip:</strong> These are minimum balanced scores. Exceeding in one event can compensate for another.
                    </p>
                </div>
            `;
        }

        function calculateCFTGoals(gender, ageGroup, perEventTarget, totalTarget) {
            const mtcReq = getMinTimeForMTCScore(gender, perEventTarget);
            const alReq = getMinRepsForALScore(gender, perEventTarget);
            const manufReq = getMinTimeForMANUFScore(gender, perEventTarget);

            return `
                <div class="goal-result">
                    <h3>ðŸŽ¯ Target: ${totalTarget}+ Points (${perEventTarget}+ per event)</h3>

                    <div class="goal-item">
                        <span class="event-name">Movement to Contact</span>
                        <span class="requirement">${mtcReq} or faster</span>
                    </div>
                    <div class="goal-item">
                        <span class="event-name">Ammunition Lift</span>
                        <span class="requirement">${alReq}+ reps</span>
                    </div>
                    <div class="goal-item">
                        <span class="event-name">Maneuver Under Fire</span>
                        <span class="requirement">${manufReq} or faster</span>
                    </div>

                    <p style="margin-top: 15px; font-size: 0.9em; color: var(--text-secondary);">
                        ðŸ’¡ <strong>Tip:</strong> These are minimum balanced scores. Exceeding in one event can compensate for another.
                    </p>
                </div>
            `;
        }

        // Helper functions for goal calculator
        function getMinTimeForPlankScore(targetScore) {
            const sortedTimes = Object.keys(plankScores).sort((a, b) => {
                const [aMin, aSec] = a.split(':').map(Number);
                const [bMin, bSec] = b.split(':').map(Number);
                return (aMin * 60 + aSec) - (bMin * 60 + bSec);
            });

            for (const time of sortedTimes) {
                if (plankScores[time] >= targetScore) {
                    return time;
                }
            }
            return '3:45+';
        }

        function getMinTimeForRunScore(gender, ageGroup, targetScore) {
            const table = runSeaLevelScores[gender]?.[ageGroup];
            if (!table) return 'N/A';

            const sortedTimes = Object.keys(table).sort((a, b) => {
                const [aMin, aSec] = a.split(':').map(Number);
                const [bMin, bSec] = b.split(':').map(Number);
                return (bMin * 60 + bSec) - (aMin * 60 + aSec); // Descending (slower first)
            });

            for (const time of sortedTimes) {
                if (table[time] >= targetScore) {
                    return time;
                }
            }
            return sortedTimes[sortedTimes.length - 1] || 'N/A';
        }

        function getMinTimeForMTCScore(gender, targetScore) {
            if (gender === 'male') {
                if (targetScore <= 40) return '3:45';
                if (targetScore <= 70) return '3:20';
                if (targetScore <= 85) return '3:00';
                return '2:40';
            } else {
                if (targetScore <= 40) return '4:36';
                if (targetScore <= 70) return '4:00';
                if (targetScore <= 85) return '3:40';
                return '3:19';
            }
        }

        function getMinRepsForALScore(gender, targetScore) {
            if (gender === 'male') {
                if (targetScore <= 40) return 62;
                if (targetScore <= 70) return 80;
                if (targetScore <= 85) return 100;
                return 120;
            } else {
                if (targetScore <= 40) return 30;
                if (targetScore <= 70) return 40;
                if (targetScore <= 85) return 50;
                return 66;
            }
        }

        function getMinTimeForMANUFScore(gender, targetScore) {
            if (gender === 'male') {
                if (targetScore <= 40) return '3:17';
                if (targetScore <= 70) return '2:47';
                if (targetScore <= 85) return '2:30';
                return '2:07';
            } else {
                if (targetScore <= 40) return '4:53';
                if (targetScore <= 70) return '3:25';
                if (targetScore <= 85) return '3:15';
                return '2:55';
            }
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal-overlay')) {
                closeGoalCalculator();
            }
        });

        // ===============================
        // PRINT / EXPORT
        // ===============================
        function printResults() {
            window.print();
        }

        function shareResults(totalScore, classification, testType) {
            const text = `My USMC ${testType} Score: ${totalScore} points (${classification}) - Calculated with Semper Admin PFT/CFT Calculator`;

            if (navigator.share) {
                navigator.share({
                    title: `USMC ${testType} Score`,
                    text: text,
                    url: window.location.href
                }).catch(console.error);
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(text).then(() => {
                    alert('Score copied to clipboard!');
                }).catch(() => {
                    alert(text);
                });
            }
        }

        // ===============================
        // PWA SUPPORT
        // ===============================
        let deferredPrompt;

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;

            // Show install prompt after a delay if not already installed
            setTimeout(() => {
                if (deferredPrompt && !localStorage.getItem('pwa-dismissed')) {
                    document.getElementById('install-prompt').classList.add('show');
                }
            }, 3000);
        });

        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('PWA installed');
                    }
                    deferredPrompt = null;
                    document.getElementById('install-prompt').classList.remove('show');
                });
            }
        }

        function dismissInstallPrompt() {
            document.getElementById('install-prompt').classList.remove('show');
            localStorage.setItem('pwa-dismissed', 'true');
        }

        // Register service worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registered:', registration.scope);
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }

        // Initialize history on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadTheme();
            renderHistory();
        });
    </script>
</body>
</html>